<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>MD Labs â€” AI ê³¼ì‹¤ë¹„ìœ¨ ë¶„ì„ v7.0</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš–ï¸</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>if(window.pdfjsLib){window.pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'}</script>
<style>
:root{--bg:#050810;--card:rgba(12,17,30,.82);--b1:rgba(148,163,184,.08);--b2:rgba(148,163,184,.18);--t1:#f1f5f9;--t2:#94a3b8;--t3:#64748b;--blue:#3b82f6;--indigo:#6366f1;--violet:#8b5cf6;--emerald:#10b981;--amber:#f59e0b;--red:#ef4444;--cyan:#06b6d4;--sans:'Noto Sans KR',system-ui,sans-serif;--mono:'JetBrains Mono',monospace}
*{box-sizing:border-box;margin:0;padding:0}html,body,#root{min-height:100vh;overflow-x:hidden}
body{background:var(--bg);color:var(--t1);font-family:var(--sans);-webkit-font-smoothing:antialiased}
::selection{background:rgba(99,102,241,.35)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(148,163,184,.18);border-radius:3px}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
textarea,input,button,select{font-family:var(--sans)}
.drop-active{border-color:var(--blue)!important;background:rgba(59,130,246,.08)!important}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback,useMemo}=React;

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 0 â€” SECURITY                                        â•‘
   â•‘  ì…ë ¥ ê²€ì¦ Â· XSS ë°©ì§€ Â· ë°ì´í„° ë¬´ê²°ì„±                       â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SEC={
  sanitize(str){
    if(typeof str!=='string')return'';
    return str.replace(/[<>&"']/g,c=>({'<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;',"'":'&#39;'})[c]||c);
  },
  validateText(str,maxLen=10000){
    if(typeof str!=='string')return'';
    return str.slice(0,maxLen).replace(/[\x00-\x08\x0B\x0C\x0E-\x1F]/g,'');
  },
  validateFile(file,maxMB=50){
    if(!file)return{ok:false,reason:'íŒŒì¼ ì—†ìŒ'};
    const mb=file.size/1024/1024;
    if(mb>maxMB)return{ok:false,reason:`${maxMB}MB ì´ˆê³¼`};
    const ext=(file.name||'').split('.').pop().toLowerCase();
    const allowed=['pdf','jpg','jpeg','png','gif','webp','bmp','mp4','mov','avi','webm','txt'];
    if(!allowed.includes(ext)&&!file.type?.match(/^(image|video|application\/pdf|text)\//))
      return{ok:false,reason:'ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹'};
    return{ok:true};
  },
  safeJSON(key,fallback=[]){
    try{const d=localStorage.getItem(key);return d?JSON.parse(d):fallback}catch{return fallback}
  },
  safeStore(key,data,maxItems=200){
    try{const d=Array.isArray(data)?data.slice(0,maxItems):data;localStorage.setItem(key,JSON.stringify(d))}catch(e){console.warn('Storage failed:',e)}
  }
};

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 1 â€” DATA (ì½”ë“œì™€ ì™„ì „ ë¶„ë¦¬ëœ ë°ì´í„°)                  â•‘
   â•‘  ë„í‘œ DB Â· ë²•ê·œ DB Â· ìˆ˜ì •ìš”ì†Œ DB                             â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ 1-A. ìˆ˜ì •ìš”ì†Œ ë§ˆìŠ¤í„° DB (18ê°œ) â”€â”€ */
const MODS_DB=[
  {id:"M01",name:"ì•¼ê°„",keywords:["ì•¼ê°„","ë°¤","ì–´ë‘","ìƒˆë²½","ì‹¬ì•¼","í•œë°¤"],adj:5,desc:"ì•¼ê°„ ìš´ì „ìœ¼ë¡œ ì‹œì•¼ ì œí•œ"},
  {id:"M02",name:"ì–´ë¦°ì´Â·ë…¸ì•½ì",keywords:["ì–´ë¦°ì´","ì•„ì´","ë…¸ì•½ì","ë…¸ì¸","ì¥ì• ì¸","ìœ ì•„","ì´ˆë“±","ì–´ë¥´ì‹ "],adj:-10,desc:"êµí†µì•½ì ë³´í˜¸ì˜ë¬´ ê°€ì¤‘"},
  {id:"M03",name:"ê³¼ì†",keywords:["ê³¼ì†","ì œí•œì†ë„ ì´ˆê³¼","ì†ë„ìœ„ë°˜","ê³ ì†"],adj:10,desc:"ì œí•œì†ë„ ì´ˆê³¼ ìš´í–‰"},
  {id:"M04",name:"ìŒì£¼",keywords:["ìŒì£¼","ìˆ ","ë§Œì·¨","í˜ˆì¤‘ì•Œì½œ","ìŒì£¼ìš´ì „"],adj:15,desc:"ìŒì£¼ìƒíƒœ ìš´ì „ (ì¤‘ê³¼ì‹¤)"},
  {id:"M05",name:"ë°©í–¥ì§€ì‹œë“± ë¯¸ì‚¬ìš©",keywords:["ê¹œë¹¡ì´","ê¹œë°•ì´","ë°©í–¥ì§€ì‹œ","ì‹ í˜¸ ì—†ì´","ì§€ì‹œë“±"],adj:5,desc:"ì°¨ë¡œë³€ê²½ì‹œ ë°©í–¥ì§€ì‹œë“± ë¯¸ì ë“±"},
  {id:"M06",name:"ê¸‰ì œë™",keywords:["ê¸‰ì •ê±°","ê¸‰ì œë™","ê¸‰ë¸Œë ˆì´í¬","ê¸‰ì •ì§€"],adj:10,desc:"í•©ë¦¬ì  ì´ìœ  ì—†ëŠ” ê¸‰ì œë™"},
  {id:"M07",name:"ìš°ì²œ",keywords:["ìš°ì²œ","ë¹„","ë¹—ê¸¸","í­ìš°","ë¯¸ë„ëŸ¬","ë…¸ë©´ ì –"],adj:3,desc:"ìš°ì²œì‹œ ì‹œì•¼Â·ì œë™ê±°ë¦¬ ë¶ˆë¦¬"},
  {id:"M08",name:"ë¼ì–´ë“¤ê¸°",keywords:["ë¼ì–´ë“¤ê¸°","ë¼ì–´ë“¤","ë¬´ë¦¬í•œ ì§„ì…"],adj:5,desc:"ë¬´ë¦¬í•œ ë¼ì–´ë“¤ê¸°"},
  {id:"M09",name:"ì—­ì£¼í–‰",keywords:["ì—­ì£¼í–‰","ë°˜ëŒ€ë°©í–¥","ì—­ë°©í–¥"],adj:20,desc:"ì—­ì£¼í–‰ (ì¤‘ê³¼ì‹¤)"},
  {id:"M10",name:"ë¬´ë©´í—ˆ",keywords:["ë¬´ë©´í—ˆ","ë©´í—ˆì·¨ì†Œ","ë©´í—ˆì •ì§€"],adj:15,desc:"ë¬´ë©´í—ˆ ìš´ì „ (ì¤‘ê³¼ì‹¤)"},
  {id:"M11",name:"ì‹ í˜¸ìœ„ë°˜",keywords:["ì‹ í˜¸ìœ„ë°˜","ì ìƒ‰ì§„ì…","ë¹¨ê°„ë¶ˆ"],adj:20,desc:"êµí†µì‹ í˜¸ ìœ„ë°˜ (ì¤‘ê³¼ì‹¤)"},
  {id:"M12",name:"ì•ˆì „ê±°ë¦¬ ë¯¸í™•ë³´",keywords:["ì•ˆì „ê±°ë¦¬","ë°”ì§","ë°€ì°©","ì°¨ê°„ê±°ë¦¬"],adj:5,desc:"ì•ˆì „ê±°ë¦¬ ë¯¸í™•ë³´"},
  {id:"M13",name:"ì¤‘ì•™ì„  ì¹¨ë²”",keywords:["ì¤‘ì•™ì„ ","ì¤‘ì•™ì„ ì¹¨ë²”","ì¤‘ì•™ì„  ë„˜"],adj:20,desc:"ì¤‘ì•™ì„  ì¹¨ë²” (ì¤‘ê³¼ì‹¤)"},
  {id:"M14",name:"ë³´í–‰ì ë³´í˜¸ì˜ë¬´ ìœ„ë°˜",keywords:["íš¡ë‹¨ë³´ë„ ë¯¸ì •ì§€","ë³´í–‰ì ë¬´ì‹œ","ë³´í–‰ì ë³´í˜¸"],adj:10,desc:"ë³´í–‰ì ë³´í˜¸ì˜ë¬´ ìœ„ë°˜"},
  {id:"M15",name:"ì•ˆì „ë²¨íŠ¸ ë¯¸ì°©ìš©",keywords:["ì•ˆì „ë²¨íŠ¸","ë²¨íŠ¸ ë¯¸ì°©ìš©","ì‹œíŠ¸ë²¨íŠ¸"],adj:3,desc:"ì•ˆì „ë²¨íŠ¸ ë¯¸ì°©ìš©"},
  {id:"M16",name:"í•œëˆˆíŒ”ê¸°",keywords:["í•œëˆˆ","ì „ë°©ì£¼ì‹œ","í•¸ë“œí°","ìŠ¤ë§ˆíŠ¸í°","DMB","íœ´ëŒ€í°"],adj:10,desc:"ì „ë°©ì£¼ì‹œì˜ë¬´ ìœ„ë°˜"},
  {id:"M17",name:"ì ì¬ë¬¼ ê³¼ì ",keywords:["ê³¼ì ","ì ì¬","ê³¼ë‹¤ì ì¬","ì ì¬ëŸ‰"],adj:5,desc:"ì ì¬ë¬¼ ê³¼ì "},
  {id:"M18",name:"ë„ë¡œê³µì‚¬Â·ì¥ì• ë¬¼",keywords:["ê³µì‚¬","ì¥ì• ë¬¼","ë„ë¡œê³µì‚¬","ë‚™í•˜ë¬¼"],adj:-5,desc:"ë„ë¡œ í™˜ê²½ìš”ì¸ ì°¸ì‘"}
];

/* â”€â”€ 1-B. ë²•ê·œ ë§ˆìŠ¤í„° DB â”€â”€ */
const LAWS_DB=[
  {id:"L01",article:"ë„ë¡œêµí†µë²• ì œ5ì¡°",desc:"ì‹ í˜¸Â·ì§€ì‹œ ì¤€ìˆ˜ ì˜ë¬´",triggers:["ì‹ í˜¸","ì ìƒ‰","ë…¹ìƒ‰","í™©ìƒ‰","êµì°¨ë¡œ"]},
  {id:"L02",article:"ë„ë¡œêµí†µë²• ì œ13ì¡° ì œ3í•­",desc:"ì¤‘ì•™ì„  ìš°ì¸¡ í†µí–‰ ì˜ë¬´",triggers:["ì¤‘ì•™ì„ ","ì¹¨ë²”","ì—­ì£¼í–‰"]},
  {id:"L03",article:"ë„ë¡œêµí†µë²• ì œ17ì¡°",desc:"ì œí•œì†ë„ ì¤€ìˆ˜",triggers:["ê³¼ì†","ì†ë„"]},
  {id:"L04",article:"ë„ë¡œêµí†µë²• ì œ19ì¡° ì œ1í•­",desc:"ì•ˆì „ê±°ë¦¬ í™•ë³´ ì˜ë¬´",triggers:["ì¶”ëŒ","ì•ˆì „ê±°ë¦¬","í›„í–‰"]},
  {id:"L05",article:"ë„ë¡œêµí†µë²• ì œ19ì¡° ì œ3í•­",desc:"ì°¨ë¡œë³€ê²½ì‹œ í†µí–‰ ë°©í•´ ê¸ˆì§€",triggers:["ì°¨ì„ ë³€ê²½","ì°¨ë¡œë³€ê²½","ë¼ì–´ë“¤ê¸°"]},
  {id:"L06",article:"ë„ë¡œêµí†µë²• ì œ21ì¡°",desc:"ì•ì§€ë¥´ê¸° ë°©ë²•Â·ê¸ˆì§€",triggers:["ì•ì§€ë¥´ê¸°","ì¶”ì›”"]},
  {id:"L07",article:"ë„ë¡œêµí†µë²• ì œ25ì¡°",desc:"êµì°¨ë¡œ í†µí–‰ë°©ë²• (ì¢ŒÂ·ìš°íšŒì „)",triggers:["ì¢ŒíšŒì „","ìš°íšŒì „","êµì°¨ë¡œ","ë¹„ë³´í˜¸"]},
  {id:"L08",article:"ë„ë¡œêµí†µë²• ì œ25ì¡° ì œ2í•­",desc:"ìš°íšŒì „ì‹œ ì„œí–‰ ë° ë³´í–‰ì ë³´í˜¸",triggers:["ìš°íšŒì „","ë³´í–‰ì"]},
  {id:"L09",article:"ë„ë¡œêµí†µë²• ì œ26ì¡°",desc:"êµí†µì •ë¦¬ ì—†ëŠ” êµì°¨ë¡œ",triggers:["ë¬´ì‹ í˜¸","ë¹„ì‹ í˜¸","êµì°¨ë¡œ","ìš°ì„ "]},
  {id:"L10",article:"ë„ë¡œêµí†µë²• ì œ27ì¡°",desc:"íš¡ë‹¨ë³´ë„ ë³´í–‰ì ë³´í˜¸ ì˜ë¬´",triggers:["íš¡ë‹¨ë³´ë„","ë³´í–‰ì","íš¡ë‹¨"]},
  {id:"L11",article:"ë„ë¡œêµí†µë²• ì œ44ì¡°",desc:"ìŒì£¼ìš´ì „ ê¸ˆì§€",triggers:["ìŒì£¼","ìˆ "]},
  {id:"L12",article:"ë„ë¡œêµí†µë²• ì œ48ì¡°",desc:"ì•ˆì „ìš´ì „ ì˜ë¬´",triggers:["ì•ˆì „ìš´ì „"]},
  {id:"L13",article:"ë„ë¡œêµí†µë²• ì œ49ì¡° ì œ1í•­ ì œ8í˜¸",desc:"ë¬¸ì—´ê¸° ì•ˆì „í™•ì¸ ì˜ë¬´",triggers:["ë¬¸ì—´ê¸°","ë„ì–´ë§","ë¬¸"]},
  {id:"L14",article:"ë¯¼ë²• ì œ750ì¡°",desc:"ë¶ˆë²•í–‰ìœ„ ì†í•´ë°°ìƒ ì±…ì„",triggers:[]},
  {id:"L15",article:"ìë™ì°¨ì†í•´ë°°ìƒë³´ì¥ë²• ì œ3ì¡°",desc:"ìš´í–‰ì ì±…ì„",triggers:[]},
  {id:"L16",article:"êµí†µì‚¬ê³ ì²˜ë¦¬íŠ¹ë¡€ë²• ì œ3ì¡°",desc:"ì²˜ë²Œ íŠ¹ë¡€ (12ëŒ€ ì¤‘ê³¼ì‹¤)",triggers:["ì¤‘ì•™ì„ ","ì‹ í˜¸ìœ„ë°˜","ìŒì£¼","ë¬´ë©´í—ˆ"]},
  {id:"L17",article:"ë„ë¡œêµí†µë²• ì œ60ì¡°",desc:"ê³ ì†ë„ë¡œ ìµœì €ì†ë„Â·ê°“ê¸¸ ì§„ì… ê¸ˆì§€",triggers:["ê³ ì†ë„ë¡œ"]},
  {id:"L18",article:"ë„ë¡œêµí†µë²• ì œ63ì¡°",desc:"ê³ ì†ë„ë¡œ í•©ë¥˜Â·ì§„ì¶œ ë°©ë²•",triggers:["í•©ë¥˜","ì§„ì…","ê°€ì†ì°¨ë¡œ"]},
];

/* â”€â”€ 1-C. KNIA ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€ ë„í‘œ DB â”€â”€
   v6.3 ëŒ€ë¹„ ë³€ê²½: patterns[] ë°°ì—´ë¡œ ë§¤ì¹­ ê·œì¹™ì„ ë°ì´í„°í™”
   â†’ matchDiagram()ì—ì„œ ifë¬¸ í•˜ë“œì½”ë”© ì™„ì „ ì œê±°
   patterns: [{words:[í•„ìˆ˜í‚¤ì›Œë“œ], weight:ê°€ì¤‘ì¹˜, require:'all'|'any'}]
*/
const DB=[
// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: êµì°¨ë¡œ ì‹ í˜¸ â•â•â•â•â•â•
{id:"101",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë…¹ìƒ‰ì§ì§„ vs ì ìƒ‰ì§ì§„",bf:{a:0,b:100},
  mods:[{n:"ê³¼ì†",v:5,tg:"a"},{n:"í˜„ì €í•œ ê³¼ì‹¤",v:5,tg:"a"},{n:"ì¤‘ëŒ€í•œ ê³¼ì‹¤",v:10,tg:"a"}],
  kw:["ë…¹ìƒ‰","ì§ì§„","ì ìƒ‰","êµì°¨ë¡œ","ì‹ í˜¸"],la:"ë…¹ìƒ‰ì§ì§„",lb:"ì ìƒ‰ì§ì§„",
  patterns:[{w:["ë…¹ìƒ‰","ì§ì§„","ì ìƒ‰","ì§ì§„"],wt:40,req:"all"},{w:["ì‹ í˜¸ìœ„ë°˜","ì§ì§„"],wt:20,req:"all"}]},
{id:"102",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë…¹ìƒ‰ì§ì§„ vs ì ìƒ‰ì¢ŒíšŒì „",bf:{a:0,b:100},mods:[],
  kw:["ë…¹ìƒ‰","ì§ì§„","ì ìƒ‰","ì¢ŒíšŒì „","êµì°¨ë¡œ"],la:"ë…¹ìƒ‰ì§ì§„",lb:"ì ìƒ‰ì¢ŒíšŒì „",
  patterns:[{w:["ë…¹ìƒ‰","ì§ì§„","ì ìƒ‰","ì¢ŒíšŒì „"],wt:40,req:"all"}]},
{id:"103",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë…¹ìƒ‰ì§ì§„ vs í™©ìƒ‰ì§ì§„",bf:{a:20,b:80},
  mods:[{n:"ê³¼ì†",v:5,tg:"a"}],kw:["ë…¹ìƒ‰","ì§ì§„","í™©ìƒ‰","êµì°¨ë¡œ"],la:"ë…¹ìƒ‰ì§ì§„",lb:"í™©ìƒ‰ì§ì§„",
  patterns:[{w:["ë…¹ìƒ‰","ì§ì§„","í™©ìƒ‰"],wt:35,req:"all"}]},
{id:"104",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"í™©ìƒ‰ì§ì§„ vs ì ìƒ‰ì§ì§„",bf:{a:30,b:70},mods:[],
  kw:["í™©ìƒ‰","ì ìƒ‰","ì§ì§„","êµì°¨ë¡œ"],la:"í™©ìƒ‰ì§ì§„",lb:"ì ìƒ‰ì§ì§„",
  patterns:[{w:["í™©ìƒ‰","ì ìƒ‰","ì§ì§„"],wt:35,req:"all"}]},
{id:"105",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ì–‘ìª½ ì ìƒ‰ ì§ì§„",bf:{a:50,b:50},
  mods:[{n:"ì„ ì§„ì…",v:-10}],kw:["ì ìƒ‰","ì§ì§„","ì–‘ìª½","êµì°¨ë¡œ","ìŒë°©"],la:"Aì°¨",lb:"Bì°¨",
  patterns:[{w:["ì ìƒ‰","ì–‘ìª½"],wt:30,req:"all"},{w:["ìŒë°©","ì ìƒ‰"],wt:25,req:"all"},{w:["ì–‘ìª½","ì‹ í˜¸ìœ„ë°˜"],wt:25,req:"all"}]},
{id:"106",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ì§ì§„ vs ë¹„ë³´í˜¸ì¢ŒíšŒì „",bf:{a:20,b:80},
  mods:[{n:"ì¢ŒíšŒì „ì™„ë£Œì§ì „",v:10,tg:"a"},{n:"ê³¼ì†",v:5,tg:"a"}],
  kw:["ë…¹ìƒ‰","ì§ì§„","ë¹„ë³´í˜¸","ì¢ŒíšŒì „","êµì°¨ë¡œ"],la:"ì§ì§„ì°¨",lb:"ì¢ŒíšŒì „ì°¨",
  patterns:[{w:["ë¹„ë³´í˜¸","ì¢ŒíšŒì „"],wt:40,req:"all"},{w:["ì§ì§„","ë¹„ë³´í˜¸ì¢ŒíšŒì „"],wt:35,req:"all"},{w:["ë¹„ë³´í˜¸","ì¢ŒíšŒì „","ì§ì§„"],wt:45,req:"all"}]},
{id:"107",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ì¢ŒíšŒì „ì‹ í˜¸ì¢ŒíšŒì „ vs ì ìƒ‰ì§ì§„",bf:{a:0,b:100},mods:[],
  kw:["ì¢ŒíšŒì „","ì‹ í˜¸","ì ìƒ‰","ì§ì§„","êµì°¨ë¡œ"],la:"ì¢ŒíšŒì „ì°¨",lb:"ì ìƒ‰ì§ì§„",
  patterns:[{w:["ì¢ŒíšŒì „ì‹ í˜¸","ì ìƒ‰","ì§ì§„"],wt:35,req:"all"},{w:["ì¢ŒíšŒì „","ì‹ í˜¸","ì ìƒ‰"],wt:30,req:"all"}]},
{id:"108",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë…¹ìƒ‰ìš°íšŒì „ vs íš¡ë°©í–¥ì§ì§„",bf:{a:80,b:20},mods:[],
  kw:["ìš°íšŒì „","ë…¹ìƒ‰","íš¡ë°©í–¥","ì§ì§„","êµì°¨ë¡œ"],la:"ìš°íšŒì „ì°¨",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ë…¹ìƒ‰","ìš°íšŒì „","íš¡ë°©í–¥"],wt:30,req:"all"},{w:["ìš°íšŒì „","ì§ì§„","êµì°¨ë¡œ"],wt:15,req:"all"}]},
{id:"109",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ì ìƒ‰ìš°íšŒì „ vs ë…¹ìƒ‰ì§ì§„",bf:{a:90,b:10},mods:[],
  kw:["ì ìƒ‰","ìš°íšŒì „","ë…¹ìƒ‰","ì§ì§„","êµì°¨ë¡œ"],la:"ì ìƒ‰ìš°íšŒì „",lb:"ë…¹ìƒ‰ì§ì§„",
  patterns:[{w:["ì ìƒ‰","ìš°íšŒì „"],wt:40,req:"all"},{w:["ì ìƒ‰ìš°íšŒì „"],wt:35,req:"all"},{w:["ìš°íšŒì „","ì ìƒ‰","ë…¹ìƒ‰","ì§ì§„"],wt:40,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: ë¬´ì‹ í˜¸ êµì°¨ë¡œ â•â•â•â•â•â•
{id:"201",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ê°™ì€í­ êµì°¨ë¡œ ìš°ì¸¡ì°¨ ìš°ì„ ",bf:{a:40,b:60},
  mods:[{n:"ê³¼ì†",v:5}],kw:["ë¬´ì‹ í˜¸","êµì°¨ë¡œ","ê°™ì€","ë™ì¼","ìš°ì¸¡","ì¢Œì¸¡"],la:"ì¢Œì¸¡ì°¨",lb:"ìš°ì¸¡ì°¨",
  patterns:[{w:["ë¬´ì‹ í˜¸","êµì°¨ë¡œ","ê°™ì€"],wt:25,req:"all"},{w:["ë¬´ì‹ í˜¸","ìš°ì¸¡","ìš°ì„ "],wt:30,req:"all"},{w:["ë™ì¼","í­","êµì°¨ë¡œ"],wt:20,req:"all"}]},
{id:"202",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë„“ì€ë„ë¡œ vs ì¢ì€ë„ë¡œ",bf:{a:30,b:70},
  mods:[{n:"ê³¼ì†",v:5,tg:"a"}],kw:["ë¬´ì‹ í˜¸","êµì°¨ë¡œ","ë„“ì€","ì¢ì€","ê´‘ë¡œ","í˜‘ë¡œ"],la:"ë„“ì€ë„ë¡œ",lb:"ì¢ì€ë„ë¡œ",
  patterns:[{w:["ë„“ì€","ì¢ì€","êµì°¨ë¡œ"],wt:30,req:"all"},{w:["ê´‘ë¡œ","í˜‘ë¡œ"],wt:30,req:"all"},{w:["ë¬´ì‹ í˜¸","í°ê¸¸","ì¢ì€ê¸¸"],wt:25,req:"all"}]},
{id:"203",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë¬´ì‹ í˜¸ ì§ì§„ vs ì¢ŒíšŒì „",bf:{a:30,b:70},
  mods:[{n:"ê³¼ì†",v:10,tg:"a"}],kw:["ë¬´ì‹ í˜¸","êµì°¨ë¡œ","ì§ì§„","ì¢ŒíšŒì „"],la:"ì§ì§„ì°¨",lb:"ì¢ŒíšŒì „ì°¨",
  patterns:[{w:["ë¬´ì‹ í˜¸","ì§ì§„","ì¢ŒíšŒì „"],wt:35,req:"all"},{w:["ë¹„ì‹ í˜¸","êµì°¨ë¡œ","ì¢ŒíšŒì „"],wt:25,req:"all"}]},
{id:"204",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë¬´ì‹ í˜¸ ì§ì§„ vs ìš°íšŒì „",bf:{a:20,b:80},mods:[],
  kw:["ë¬´ì‹ í˜¸","êµì°¨ë¡œ","ì§ì§„","ìš°íšŒì „"],la:"ì§ì§„ì°¨",lb:"ìš°íšŒì „ì°¨",
  patterns:[{w:["ë¬´ì‹ í˜¸","ì§ì§„","ìš°íšŒì „"],wt:35,req:"all"}]},
{id:"205",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ë¬´ì‹ í˜¸ Tìë¡œ ì§ì§„ vs ì§„ì…",bf:{a:30,b:70},mods:[],
  kw:["ë¬´ì‹ í˜¸","Tì","ì§ì§„","ì§„ì…"],la:"ì§ì§„ì°¨",lb:"ì§„ì…ì°¨",
  patterns:[{w:["Tì","ì§„ì…"],wt:30,req:"all"},{w:["Tìë¡œ","ì§ì§„"],wt:25,req:"all"},{w:["ì‚¼ê±°ë¦¬","ì§„ì…","ì§ì§„"],wt:20,req:"all"}]},
{id:"206",cat:"ì°¨ëŒ€ì°¨",sub:"êµì°¨ë¡œ",t:"ì¼ì‹œì •ì§€ í‘œì§€ ë¬´ì‹œ ì§„ì…",bf:{a:10,b:90},mods:[],
  kw:["ì¼ì‹œì •ì§€","ì •ì§€","í‘œì§€","ë¬´ì‹œ","ì§„ì…","êµì°¨ë¡œ"],la:"ì§ì§„ì°¨",lb:"ì •ì§€ìœ„ë°˜ì°¨",
  patterns:[{w:["ì¼ì‹œì •ì§€","ë¬´ì‹œ"],wt:40,req:"all"},{w:["ì •ì§€í‘œì§€","ìœ„ë°˜"],wt:35,req:"all"},{w:["ì¼ì‹œì •ì§€","ì§„ì…"],wt:30,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: ëŒ€í–¥(ë§ˆì£¼ë³´ëŠ”) â•â•â•â•â•â•
{id:"301",cat:"ì°¨ëŒ€ì°¨",sub:"ëŒ€í–¥",t:"ì¤‘ì•™ì„  ì¹¨ë²”",bf:{a:0,b:100},
  mods:[{n:"ì•¼ê°„ë¯¸ë“±",v:5,tg:"a"},{n:"í˜„ì €í•œ ê³¼ì‹¤",v:5,tg:"a"}],
  kw:["ì¤‘ì•™ì„ ","ì¹¨ë²”","ì—­ì£¼í–‰","ëŒ€í–¥","ë§ˆì£¼"],la:"í”¼í•´ì°¨",lb:"ì¹¨ë²”ì°¨",
  patterns:[{w:["ì¤‘ì•™ì„ ","ì¹¨ë²”"],wt:45,req:"all"},{w:["ì¤‘ì•™ì„ ì¹¨ë²”"],wt:45,req:"all"},{w:["ì—­ì£¼í–‰","ì •ë©´"],wt:35,req:"all"},{w:["ì¤‘ì•™ì„ ","ë„˜"],wt:35,req:"all"}]},
{id:"302",cat:"ì°¨ëŒ€ì°¨",sub:"ëŒ€í–¥",t:"ì¢ŒíšŒì „ vs ì§ì§„(ëŒ€í–¥)",bf:{a:80,b:20},
  mods:[{n:"ì¢ŒíšŒì „ì™„ë£Œì§ì „",v:-10,tg:"a"},{n:"ê³¼ì†",v:10,tg:"b"}],
  kw:["ì¢ŒíšŒì „","ì§ì§„","ëŒ€í–¥","ë§ˆì£¼"],la:"ì¢ŒíšŒì „ì°¨",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ì¢ŒíšŒì „","ì§ì§„","ëŒ€í–¥"],wt:30,req:"all"},{w:["ì¢ŒíšŒì „","ë§ˆì£¼ì˜¤ëŠ”","ì§ì§„"],wt:30,req:"all"},{w:["ëŒ€í–¥","ì¢ŒíšŒì „"],wt:20,req:"all"}]},
{id:"303",cat:"ì°¨ëŒ€ì°¨",sub:"ëŒ€í–¥",t:"ìœ í„´ vs ì§ì§„",bf:{a:80,b:20},
  mods:[{n:"ê³¼ì†",v:5,tg:"b"}],kw:["ìœ í„´","Uí„´","ì§ì§„","ëŒ€í–¥"],la:"ìœ í„´ì°¨",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ìœ í„´"],wt:40,req:"any"},{w:["uí„´"],wt:40,req:"any"},{w:["ìœ í„´","ì§ì§„"],wt:45,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: ë™í–‰(ì¶”ëŒÂ·ì°¨ì„ ë³€ê²½) â•â•â•â•â•â•
{id:"401",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"í›„í–‰ì°¨ ì¶”ëŒ (ê¸°ë³¸)",bf:{a:0,b:100},
  mods:[{n:"ê¸‰ì œë™",v:20,tg:"a"},{n:"ê¸‰ì •ê±°",v:20,tg:"a"}],
  kw:["ì¶”ëŒ","í›„í–‰","ì•ì°¨","ë’·ì°¨","ì•ˆì „ê±°ë¦¬","ë™ì¼ë°©í–¥"],la:"ì„ í–‰ì°¨",lb:"í›„í–‰ì°¨",
  patterns:[{w:["ì¶”ëŒ","ë’·ì°¨"],wt:30,req:"all"},{w:["ì¶”ëŒ","í›„í–‰"],wt:30,req:"all"},{w:["ë’¤ì—ì„œ","ì¶”ëŒ"],wt:25,req:"all"},{w:["ì•ì°¨","ì¶”ëŒ"],wt:25,req:"all"},{w:["ì•ˆì „ê±°ë¦¬","ì¶”ëŒ"],wt:30,req:"all"}]},
{id:"402",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ì„ í–‰ì°¨ ê¸‰ì •ê±° í›„ ì¶”ëŒ",bf:{a:20,b:80},
  mods:[{n:"ë„ë¡œìœ„í—˜ë¬¼",v:-10,tg:"a"}],kw:["ê¸‰ì •ê±°","ê¸‰ì œë™","ì¶”ëŒ","ì •ì§€"],la:"ê¸‰ì •ê±°ì°¨",lb:"í›„í–‰ì°¨",
  patterns:[{w:["ê¸‰ì •ê±°","ì¶”ëŒ"],wt:40,req:"all"},{w:["ê¸‰ì œë™","ì¶”ëŒ"],wt:40,req:"all"},{w:["ê°‘ìê¸°","ë©ˆ","ì¶”ëŒ"],wt:30,req:"all"},{w:["ê¸‰ë¸Œë ˆì´í¬","ì¶”ëŒ"],wt:35,req:"all"}]},
{id:"403",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ì ë²•ì£¼ì •ì°¨ ì°¨ëŸ‰ ì¶”ëŒ",bf:{a:0,b:100},
  mods:[{n:"ì•¼ê°„ë¯¸ë“±",v:10,tg:"a"},{n:"ê³ ì¥ì •ì°¨",v:10,tg:"a"}],
  kw:["ì£¼ì •ì°¨","ì •ì°¨","ì£¼ì°¨","ì¶”ëŒ","ì •ì§€"],la:"ì£¼ì •ì°¨ì°¨",lb:"ì¶”ëŒì°¨",
  patterns:[{w:["ì£¼ì •ì°¨","ì¶”ëŒ"],wt:35,req:"all"},{w:["ì •ì°¨","ì¶”ëŒ"],wt:25,req:"all"},{w:["ì„¸ì›Œë‘”","ì°¨","ì¶”ëŒ"],wt:25,req:"all"}]},
{id:"404",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ë¶ˆë²•ì£¼ì •ì°¨ ì°¨ëŸ‰ ì¶”ëŒ",bf:{a:10,b:90},
  mods:[{n:"ì•¼ê°„ë¯¸ë“±",v:10,tg:"a"}],kw:["ë¶ˆë²•","ì£¼ì •ì°¨","ì¶”ëŒ"],la:"ë¶ˆë²•ì£¼ì •ì°¨",lb:"ì¶”ëŒì°¨",
  patterns:[{w:["ë¶ˆë²•","ì£¼ì •ì°¨","ì¶”ëŒ"],wt:45,req:"all"},{w:["ë¶ˆë²•ì£¼ì •ì°¨"],wt:40,req:"all"},{w:["ë¶ˆë²•","ì •ì°¨","ì¶”ëŒ"],wt:35,req:"all"}]},
{id:"405",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ì°¨ì„ ë³€ê²½ vs ì§ì§„(í›„ë°©ì¶©ëŒ)",bf:{a:70,b:30},
  mods:[{n:"ë°©í–¥ì§€ì‹œë“± ë¯¸ì‚¬ìš©",v:10,tg:"a"},{n:"ë¼ì–´ë“¤ê¸°",v:5,tg:"a"}],
  kw:["ì°¨ì„ ë³€ê²½","ì§ì§„","í›„ë°©","ë¼ì–´ë“¤ê¸°","ê¹œë¹¡ì´","ê¹œë°•ì´"],la:"ì°¨ì„ ë³€ê²½",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ì°¨ì„ ë³€ê²½","í›„ë°©"],wt:35,req:"all"},{w:["ì°¨ì„ ë³€ê²½","ë’¤"],wt:25,req:"all"},{w:["ì°¨ì„ ë³€ê²½","ì§ì§„","ì¶©ëŒ"],wt:30,req:"all"}]},
{id:"406",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ì°¨ì„ ë³€ê²½ vs ì§ì§„(ì¸¡ë©´ì¶©ëŒ)",bf:{a:80,b:20},
  mods:[{n:"ë°©í–¥ì§€ì‹œë“± ë¯¸ì‚¬ìš©",v:10,tg:"a"}],kw:["ì°¨ì„ ë³€ê²½","ì§ì§„","ì¸¡ë©´","ì¸¡ë°©","ì˜†"],la:"ì°¨ì„ ë³€ê²½",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ì°¨ì„ ë³€ê²½","ì¸¡ë©´"],wt:40,req:"all"},{w:["ì°¨ì„ ë³€ê²½","ì˜†"],wt:30,req:"all"},{w:["ì°¨ë¡œë³€ê²½","ì¸¡ë©´"],wt:35,req:"all"},{w:["ì°¨ì„ ë³€ê²½","ì§ì§„","ì¸¡"],wt:35,req:"all"}]},
{id:"407",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ë™ì‹œ ì°¨ì„ ë³€ê²½ ì¶©ëŒ",bf:{a:50,b:50},
  mods:[{n:"ë°©í–¥ì§€ì‹œë“± ë¯¸ì‚¬ìš©",v:10}],kw:["ë™ì‹œ","ì°¨ì„ ë³€ê²½","ìŒë°©"],la:"Aì°¨",lb:"Bì°¨",
  patterns:[{w:["ë™ì‹œ","ì°¨ì„ ë³€ê²½"],wt:40,req:"all"},{w:["ìŒë°©","ì°¨ì„ ë³€ê²½"],wt:35,req:"all"},{w:["ì–‘ìª½","ì°¨ì„ ë³€ê²½"],wt:30,req:"all"}]},
{id:"408",cat:"ì°¨ëŒ€ì°¨",sub:"ë™í–‰",t:"ì§„ë¡œë³€ê²½(ë¼ì–´ë“¤ê¸°) ì§í›„ ì¶”ëŒ",bf:{a:70,b:30},
  mods:[{n:"ê¸‰ì œë™",v:10,tg:"a"}],kw:["ë¼ì–´ë“¤ê¸°","ì§„ë¡œë³€ê²½","ì§í›„","ì¶”ëŒ"],la:"ë¼ì–´ë“¤ê¸°ì°¨",lb:"í›„í–‰ì°¨",
  patterns:[{w:["ë¼ì–´ë“¤ê¸°","ì¶”ëŒ"],wt:40,req:"all"},{w:["ë¼ì–´ë“¤","ì§í›„"],wt:35,req:"all"},{w:["ì§„ë¡œë³€ê²½","ì¶”ëŒ"],wt:30,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: í•©ë¥˜ â•â•â•â•â•â•
{id:"501",cat:"ì°¨ëŒ€ì°¨",sub:"í•©ë¥˜",t:"ë„ë¡œ ì§„ì… vs ì§ì§„",bf:{a:80,b:20},
  mods:[{n:"ì•¼ê°„",v:5,tg:"b"}],kw:["ì§„ì…","í•©ë¥˜","ì§ì§„","ë³¸ì„ "],la:"ì§„ì…ì°¨",lb:"ì§ì§„ì°¨",
  patterns:[{w:["ì§„ì…","ì§ì§„","í•©ë¥˜"],wt:30,req:"all"},{w:["í•©ë¥˜","ë³¸ì„ "],wt:25,req:"all"}]},
{id:"502",cat:"ì°¨ëŒ€ì°¨",sub:"í•©ë¥˜",t:"ê³ ì†ë„ë¡œ í•©ë¥˜ vs ë³¸ì„ ",bf:{a:70,b:30},
  mods:[{n:"ê°€ì†ì°¨ë¡œë¶€ì¡±",v:-10,tg:"a"}],kw:["ê³ ì†ë„ë¡œ","í•©ë¥˜","ë³¸ì„ ","ê°€ì†ì°¨ë¡œ"],la:"í•©ë¥˜ì°¨",lb:"ë³¸ì„ ì°¨",
  patterns:[{w:["ê³ ì†ë„ë¡œ","í•©ë¥˜"],wt:40,req:"all"},{w:["ê°€ì†ì°¨ë¡œ","í•©ë¥˜"],wt:35,req:"all"},{w:["ê³ ì†ë„ë¡œ","ì§„ì…"],wt:25,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì°¨: ì£¼ì°¨ì¥Â·íšŒì „êµì°¨ë¡œÂ·ê¸°íƒ€ â•â•â•â•â•â•
{id:"601",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"ì£¼ì°¨ì¥ í†µë¡œ ì§ì§„ vs ì¶œì°¨(í›„ì§„)",bf:{a:30,b:70},mods:[],
  kw:["ì£¼ì°¨ì¥","ì§ì§„","ì¶œì°¨","í›„ì§„","í†µë¡œ"],la:"ì§ì§„ì°¨",lb:"ì¶œì°¨ì°¨",
  patterns:[{w:["ì£¼ì°¨ì¥","ì¶œì°¨"],wt:40,req:"all"},{w:["ì£¼ì°¨ì¥","í›„ì§„","ì§ì§„"],wt:35,req:"all"},{w:["ì£¼ì°¨ì¥","í†µë¡œ","ì¶œì°¨"],wt:40,req:"all"}]},
{id:"602",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"ì£¼ì°¨ì¥ í†µë¡œ ë‚´ êµí–‰",bf:{a:50,b:50},
  mods:[{n:"ì—­ì£¼í–‰",v:20}],kw:["ì£¼ì°¨ì¥","í†µë¡œ","êµí–‰","êµì°¨"],la:"Aì°¨",lb:"Bì°¨",
  patterns:[{w:["ì£¼ì°¨ì¥","êµí–‰"],wt:35,req:"all"},{w:["ì£¼ì°¨ì¥","í†µë¡œ","ì¶©ëŒ"],wt:25,req:"all"}]},
{id:"603",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"íšŒì „êµì°¨ë¡œ íšŒì „ vs ì§„ì…",bf:{a:20,b:80},mods:[],
  kw:["íšŒì „êµì°¨ë¡œ","ë¡œí„°ë¦¬","íšŒì „","ì§„ì…"],la:"íšŒì „ì°¨",lb:"ì§„ì…ì°¨",
  patterns:[{w:["íšŒì „êµì°¨ë¡œ","ì§„ì…"],wt:40,req:"all"},{w:["ë¡œí„°ë¦¬","ì§„ì…"],wt:40,req:"all"},{w:["íšŒì „êµì°¨ë¡œ"],wt:20,req:"any"}]},
{id:"604",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"íšŒì „êµì°¨ë¡œ ì§„ì¶œ vs íšŒì „",bf:{a:60,b:40},mods:[],
  kw:["íšŒì „êµì°¨ë¡œ","ì§„ì¶œ","íšŒì „"],la:"ì§„ì¶œì°¨",lb:"íšŒì „ì°¨",
  patterns:[{w:["íšŒì „êµì°¨ë¡œ","ì§„ì¶œ"],wt:40,req:"all"},{w:["ë¡œí„°ë¦¬","ë‚˜ì˜¤"],wt:30,req:"all"}]},
{id:"605",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"í›„ì§„ vs í›„ì§„",bf:{a:50,b:50},mods:[],
  kw:["í›„ì§„","ìŒë°©","ë™ì‹œ"],la:"Aí›„ì§„",lb:"Bí›„ì§„",
  patterns:[{w:["í›„ì§„","í›„ì§„"],wt:35,req:"all"},{w:["ìŒë°©","í›„ì§„"],wt:35,req:"all"},{w:["ë™ì‹œ","í›„ì§„"],wt:35,req:"all"}]},
{id:"606",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"í›„ì§„ vs ì§ì§„",bf:{a:80,b:20},mods:[],
  kw:["í›„ì§„","ì§ì§„"],la:"í›„ì§„ì°¨",lb:"ì§ì§„ì°¨",
  patterns:[{w:["í›„ì§„","ì§ì§„","ì¶©ëŒ"],wt:30,req:"all"},{w:["í›„ì§„","ì§ì§„ì°¨"],wt:25,req:"all"}]},
{id:"607",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"ìœ„ë²•ì°¨ì„ ë³€ê²½ vs ì˜¤í† ë°”ì´",bf:{a:60,b:40},
  mods:[{n:"ê³¼ì†",v:10,tg:"b"}],kw:["ì´ë¥œ","ì˜¤í† ë°”ì´","ì°¨ì„ ë³€ê²½","ë°”ì´í¬"],la:"ì°¨ì„ ë³€ê²½ì°¨",lb:"ì´ë¥œì°¨",
  patterns:[{w:["ì˜¤í† ë°”ì´","ì°¨ì„ ë³€ê²½"],wt:35,req:"all"},{w:["ì´ë¥œ","ì°¨ì„ ë³€ê²½"],wt:35,req:"all"},{w:["ë°”ì´í¬","ì°¨ì„ ë³€ê²½"],wt:30,req:"all"}]},
{id:"608",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"ë¬¸ì—´ê¸°(ë„ì–´ë§) ì‚¬ê³ ",bf:{a:80,b:20},mods:[],
  kw:["ë¬¸ì—´ê¸°","ë„ì–´","ë¬¸","ì—´ê¸°","ë„ì–´ë§","ì´ë¥œ"],la:"ë¬¸ì—´ê¸°ì°¨",lb:"í†µê³¼ì°¨",
  patterns:[{w:["ë¬¸ì—´ê¸°"],wt:45,req:"any"},{w:["ë„ì–´ë§"],wt:45,req:"any"},{w:["ë¬¸","ì—´","ì¶©ëŒ"],wt:30,req:"all"},{w:["ì°¨ë¬¸","ì—´"],wt:30,req:"all"}]},
{id:"609",cat:"ì°¨ëŒ€ì°¨",sub:"ê¸°íƒ€",t:"ê³ ì†ë„ë¡œ ë³¸ì„  ì •ì§€ì°¨ ì¶”ëŒ",bf:{a:30,b:70},
  mods:[{n:"ì•¼ê°„",v:-10,tg:"a"},{n:"ì‚¼ê°ëŒ€ë¯¸ì„¤ì¹˜",v:10,tg:"a"}],
  kw:["ê³ ì†ë„ë¡œ","ì •ì§€","ì¶”ëŒ","ë³¸ì„ "],la:"ì •ì§€ì°¨",lb:"ì¶”ëŒì°¨",
  patterns:[{w:["ê³ ì†ë„ë¡œ","ì •ì§€","ì¶”ëŒ"],wt:40,req:"all"},{w:["ê³ ì†ë„ë¡œ","ì„œìˆ","ì¶”ëŒ"],wt:30,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ì‚¬ëŒ â•â•â•â•â•â•
{id:"ë³´1",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"íš¡ë‹¨ë³´ë„",t:"ì°¨ë…¹ìƒ‰ì§ì§„ vs ë³´í–‰ìì ìƒ‰íš¡ë‹¨",bf:{p:70},
  mods:[{n:"ì•¼ê°„",v:-5},{n:"ì–´ë¦°ì´Â·ë…¸ì•½ì",v:-15}],
  kw:["ë…¹ìƒ‰","ì§ì§„","ì ìƒ‰","íš¡ë‹¨","íš¡ë‹¨ë³´ë„","ë³´í–‰ì","ì‹ í˜¸"],
  patterns:[{w:["ë³´í–‰ì","ì ìƒ‰","íš¡ë‹¨"],wt:35,req:"all"},{w:["ë³´í–‰ì","ë¹¨ê°„ë¶ˆ","íš¡ë‹¨"],wt:30,req:"all"}]},
{id:"ë³´2",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"íš¡ë‹¨ë³´ë„",t:"ì°¨ì ìƒ‰ vs ë³´í–‰ìë…¹ìƒ‰",bf:{p:0},mods:[],
  kw:["ì ìƒ‰","ë…¹ìƒ‰","íš¡ë‹¨ë³´ë„","ë³´í–‰ì"],
  patterns:[{w:["ë³´í–‰ì","ë…¹ìƒ‰","íš¡ë‹¨"],wt:30,req:"all"},{w:["ì ìƒ‰","ë³´í–‰ì","íš¡ë‹¨ë³´ë„"],wt:35,req:"all"}]},
{id:"ë³´3",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"íš¡ë‹¨ë³´ë„",t:"ë¬´ì‹ í˜¸ íš¡ë‹¨ë³´ë„ ë³´í–‰ì",bf:{p:5},
  mods:[{n:"ì•¼ê°„",v:5},{n:"ì–´ë¦°ì´Â·ë…¸ì•½ì",v:-5}],kw:["ë¬´ì‹ í˜¸","íš¡ë‹¨ë³´ë„","ë³´í–‰ì","íš¡ë‹¨"],
  patterns:[{w:["ë¬´ì‹ í˜¸","íš¡ë‹¨ë³´ë„","ë³´í–‰ì"],wt:35,req:"all"},{w:["ì‹ í˜¸ì—†ëŠ”","íš¡ë‹¨ë³´ë„"],wt:25,req:"all"}]},
{id:"ë³´4",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"íš¡ë‹¨ë³´ë„",t:"ìš°íšŒì „ vs íš¡ë‹¨ë³´ë„ ë³´í–‰ì(ë…¹ìƒ‰)",bf:{p:0},mods:[],
  kw:["ìš°íšŒì „","ë³´í–‰ì","ë…¹ìƒ‰","íš¡ë‹¨ë³´ë„"],
  patterns:[{w:["ìš°íšŒì „","ë³´í–‰ì","íš¡ë‹¨"],wt:40,req:"all"},{w:["ìš°íšŒì „","íš¡ë‹¨ë³´ë„","ë³´í–‰ì"],wt:45,req:"all"}]},
{id:"ë³´5",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"íš¡ë‹¨ë³´ë„",t:"ì¢ŒíšŒì „ vs íš¡ë‹¨ë³´ë„ ë³´í–‰ì",bf:{p:0},
  mods:[{n:"ë…¹ìƒ‰ì ë©¸",v:10}],kw:["ì¢ŒíšŒì „","ë³´í–‰ì","íš¡ë‹¨ë³´ë„"],
  patterns:[{w:["ì¢ŒíšŒì „","ë³´í–‰ì","íš¡ë‹¨"],wt:35,req:"all"},{w:["ì¢ŒíšŒì „","íš¡ë‹¨ë³´ë„"],wt:30,req:"all"}]},
{id:"ë³´6",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"ê¸°íƒ€",t:"íš¡ë‹¨ë³´ë„ ë°– íš¡ë‹¨",bf:{p:20},
  mods:[{n:"ì•¼ê°„",v:5},{n:"ì–´ë¦°ì´Â·ë…¸ì•½ì",v:-5}],kw:["íš¡ë‹¨ë³´ë„","ë°–","ì™¸","ë³´í–‰ì","ë¬´ë‹¨íš¡ë‹¨"],
  patterns:[{w:["íš¡ë‹¨ë³´ë„","ë°–","íš¡ë‹¨"],wt:30,req:"all"},{w:["íš¡ë‹¨ë³´ë„","ì™¸","ë³´í–‰ì"],wt:25,req:"all"}]},
{id:"ë³´7",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"ê¸°íƒ€",t:"ì°¨ë„ ë¬´ë‹¨íš¡ë‹¨(ë³´í–‰ì)",bf:{p:30},
  mods:[{n:"ì–´ë¦°ì´Â·ë…¸ì•½ì",v:-10},{n:"ì•¼ê°„",v:5}],kw:["ë¬´ë‹¨íš¡ë‹¨","ì°¨ë„","ë³´í–‰ì"],
  patterns:[{w:["ë¬´ë‹¨íš¡ë‹¨"],wt:45,req:"any"},{w:["ë¬´ë‹¨","íš¡ë‹¨","ë³´í–‰ì"],wt:35,req:"all"}]},
{id:"ë³´8",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"ê¸°íƒ€",t:"ë³´ë„ ì¹¨ë²”",bf:{p:0},mods:[],
  kw:["ë³´ë„","ì¸ë„","ì¹¨ë²”","ë³´í–‰ì"],
  patterns:[{w:["ë³´ë„","ì¹¨ë²”"],wt:45,req:"all"},{w:["ì¸ë„","ì¹¨ë²”"],wt:45,req:"all"},{w:["ì¸ë„","ì˜¬ë¼"],wt:30,req:"all"}]},
{id:"ë³´9",cat:"ì°¨ëŒ€ì‚¬ëŒ",sub:"ê¸°íƒ€",t:"í›„ì§„ vs ë³´í–‰ì",bf:{p:10},
  mods:[{n:"ì–´ë¦°ì´Â·ë…¸ì•½ì",v:-5}],kw:["í›„ì§„","ë³´í–‰ì"],
  patterns:[{w:["í›„ì§„","ë³´í–‰ì"],wt:40,req:"all"},{w:["í›„ì§„","ì‚¬ëŒ"],wt:30,req:"all"}]},

// â•â•â•â•â•â• ì°¨ëŒ€ìì „ê±° â•â•â•â•â•â•
{id:"ê±°1",cat:"ì°¨ëŒ€ìì „ê±°",sub:"êµì°¨ë¡œ",t:"ì§ì§„ì°¨ vs ìì „ê±° íš¡ë‹¨",bf:{a:60,b:40},
  mods:[{n:"ìì „ê±°ì—­ì£¼í–‰",v:10,tg:"b"}],kw:["ìì „ê±°","íš¡ë‹¨","ì§ì§„"],la:"ìë™ì°¨",lb:"ìì „ê±°",
  patterns:[{w:["ìì „ê±°","íš¡ë‹¨","ì§ì§„"],wt:30,req:"all"}]},
{id:"ê±°2",cat:"ì°¨ëŒ€ìì „ê±°",sub:"ë™í–‰",t:"ì¶”ëŒ ìì „ê±°",bf:{a:90,b:10},
  mods:[{n:"ì•¼ê°„",v:-5,tg:"a"}],kw:["ìì „ê±°","ì¶”ëŒ"],la:"ìë™ì°¨",lb:"ìì „ê±°",
  patterns:[{w:["ìì „ê±°","ì¶”ëŒ"],wt:35,req:"all"}]},
{id:"ê±°3",cat:"ì°¨ëŒ€ìì „ê±°",sub:"ë™í–‰",t:"ì°¨ì„ ë³€ê²½ vs ìì „ê±°",bf:{a:80,b:20},mods:[],
  kw:["ìì „ê±°","ì°¨ì„ ë³€ê²½"],la:"ìë™ì°¨",lb:"ìì „ê±°",
  patterns:[{w:["ìì „ê±°","ì°¨ì„ ë³€ê²½"],wt:35,req:"all"}]},
{id:"ê±°4",cat:"ì°¨ëŒ€ìì „ê±°",sub:"ê¸°íƒ€",t:"ë¬¸ì—´ê¸° vs ìì „ê±°",bf:{a:90,b:10},mods:[],
  kw:["ìì „ê±°","ë¬¸ì—´ê¸°","ë„ì–´","ë„ì–´ë§"],la:"ìë™ì°¨",lb:"ìì „ê±°",
  patterns:[{w:["ìì „ê±°","ë¬¸ì—´ê¸°"],wt:40,req:"all"},{w:["ìì „ê±°","ë„ì–´ë§"],wt:40,req:"all"},{w:["ìì „ê±°","ë¬¸","ì—´"],wt:30,req:"all"}]},
];

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 2 â€” ENGINE (ë°ì´í„° ê¸°ë°˜ ë¶„ì„ ì—”ì§„)                    â•‘
   â•‘  ë§¤ì¹­ Â· ìˆ˜ì •ìš”ì†Œ ê°ì§€ Â· ê³¼ì‹¤ë¹„ìœ¨ ì‚°ì • Â· ë²•ê·œ ì¶”ì¶œ            â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ 2-A. ë„í‘œ ë§¤ì¹­ (íŒ¨í„´ ê¸°ë°˜ â€” ifë¬¸ ì—†ìŒ) â”€â”€ */
function matchDiagram(text){
  const t=(text||'').replace(/\s+/g,' ').toLowerCase();
  if(t.length<5)return null;

  const scored=DB.map(d=>{
    let s=0;
    // (a) ê¸°ë³¸ í‚¤ì›Œë“œ ë§¤ì¹­
    d.kw.forEach(k=>{if(t.includes(k))s+=8});
    // (b) ì¹´í…Œê³ ë¦¬ ë³´ë„ˆìŠ¤
    if((t.includes('ë³´í–‰ì')||t.includes('ì‚¬ëŒ'))&&d.cat==='ì°¨ëŒ€ì‚¬ëŒ')s+=20;
    if((t.includes('ìì „ê±°')||t.includes('ì´ë¥œ'))&&d.cat==='ì°¨ëŒ€ìì „ê±°')s+=20;
    // (c) íŒ¨í„´ ë§¤ì¹­ (ë°ì´í„° ë“œë¦¬ë¸ â€” í•µì‹¬!)
    (d.patterns||[]).forEach(p=>{
      if(p.req==='all'){
        if(p.w.every(w=>t.includes(w)))s+=p.wt;
      }else{
        if(p.w.some(w=>t.includes(w)))s+=p.wt;
      }
    });
    // (d) ì„œë¸Œì¹´í…Œê³ ë¦¬ í‚¤ì›Œë“œ ì•½í•œ ë³´ë„ˆìŠ¤
    if(t.includes('êµì°¨ë¡œ')&&d.sub==='êµì°¨ë¡œ')s+=5;
    if(t.includes('ê³ ì†ë„ë¡œ')&&d.kw.includes('ê³ ì†ë„ë¡œ'))s+=8;
    if(t.includes('ì£¼ì°¨ì¥')&&d.kw.includes('ì£¼ì°¨ì¥'))s+=8;
    return{d,score:s};
  });

  scored.sort((a,b)=>b.score-a.score);
  if(scored[0].score<15)return null;
  const top=scored[0];
  return{
    match:top.d,
    confidence:top.score>=50?"ìƒ":top.score>=30?"ì¤‘":"í•˜",
    matchScore:top.score,
    alts:scored.slice(1,4).filter(x=>x.score>=15).map(x=>({id:x.d.id,t:x.d.t,score:x.score}))
  };
}

/* â”€â”€ 2-B. ìˆ˜ì •ìš”ì†Œ ê°ì§€ (ë°ì´í„° ë“œë¦¬ë¸) â”€â”€ */
function detectMods(text){
  const t=(text||'').toLowerCase();
  return MODS_DB.filter(m=>m.keywords.some(k=>t.includes(k))).map(m=>m.name);
}

/* â”€â”€ 2-C. ê³¼ì‹¤ë¹„ìœ¨ ì‚°ì • â”€â”€ */
function calcFault(d,mods){
  let fA,fB;const isPed=d.bf.p!==undefined;
  if(isPed){fA=100-d.bf.p;fB=d.bf.p}else{fA=d.bf.a;fB=d.bf.b}
  (d.mods||[]).forEach(m=>{
    if(mods.some(am=>m.n.includes(am)||am.includes(m.n))){
      if(m.tg==='a')fA+=m.v;else if(m.tg==='b')fB+=m.v;else{if(isPed)fB+=m.v;else fA+=m.v}
    }
  });
  fA=Math.max(0,Math.min(100,fA));fB=Math.max(0,Math.min(100,fB));
  const t=fA+fB;if(t>0&&t!==100){fA=Math.round(fA/t*100);fB=100-fA}
  return{fA,fB};
}

/* â”€â”€ 2-D. ê´€ë ¨ ë²•ê·œ ì¶”ì¶œ (DB ê¸°ë°˜) â”€â”€ */
function getLaws(d,text){
  const t=(text||'').toLowerCase();
  const matched=LAWS_DB.filter(l=>
    l.triggers.length===0||(l.triggers.some(tr=>t.includes(tr)))
  );
  // ì¹´í…Œê³ ë¦¬ë³„ í•„ìˆ˜ ë²•ê·œ
  const result=[...matched];
  if(d.cat==='ì°¨ëŒ€ì‚¬ëŒ'&&!result.find(l=>l.id==='L10'))
    result.unshift(LAWS_DB.find(l=>l.id==='L10'));
  // ë¯¼ë²• 750ì¡° í•­ìƒ í¬í•¨
  if(!result.find(l=>l.id==='L14'))result.push(LAWS_DB.find(l=>l.id==='L14'));
  // ì¤‘ë³µ ì œê±° + ìµœëŒ€ 8ê°œ
  const unique=[...new Map(result.filter(Boolean).map(l=>[l.id,l])).values()];
  return unique.slice(0,8).map(l=>({a:l.article,d:l.desc}));
}

/* â”€â”€ 2-E. AI ê°ì •ì„œ ë¶„ì„ í…ìŠ¤íŠ¸ ìƒì„± â”€â”€ */
function generateAnalysis(r,input){
  const d=r.diagram;const isPed=d.cat==='ì°¨ëŒ€ì‚¬ëŒ';const isBike=d.cat==='ì°¨ëŒ€ìì „ê±°';
  const lines=[];

  // ì‚¬ê³  ìœ í˜• ë¶„ì„
  lines.push(`ë³¸ ê±´ì€ ${d.cat} ì‚¬ê³  ì¤‘ "${d.sub}" ìœ í˜•ì— í•´ë‹¹í•˜ë©°, ì†í•´ë³´í—˜í˜‘íšŒ ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€ ë„í‘œ ${d.id}(${d.t})ì´ ì ìš©ë©ë‹ˆë‹¤.`);

  // ê³¼ì‹¤ ê·¼ê±°
  if(isPed){
    lines.push(`ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨ì€ ì°¨ëŸ‰ì¸¡ ${100-d.bf.p}% : ë³´í–‰ì ${d.bf.p}%ì…ë‹ˆë‹¤.`);
    if(d.bf.p===0)lines.push(`ë³´í–‰ìê°€ ì •ë‹¹í•œ í†µí–‰ê¶Œì„ ê°€ì§„ ìƒí™©ìœ¼ë¡œ, ì°¨ëŸ‰ì¸¡ì— ì „ì ì¸ ê³¼ì‹¤ì´ ì¸ì •ë©ë‹ˆë‹¤.`);
    else lines.push(`ë³´í–‰ìì—ê²Œë„ ${d.bf.p}%ì˜ ê¸°ë³¸ ê³¼ì‹¤ì´ ì¸ì •ë˜ëŠ” ê²ƒì€ ë³´í–‰ìì˜ ì•ˆì „ì£¼ì˜ ì˜ë¬´ì— ê¸°ì¸í•©ë‹ˆë‹¤.`);
  }else if(isBike){
    lines.push(`ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨ì€ ìë™ì°¨ ${d.bf.a}% : ìì „ê±° ${d.bf.b}%ì…ë‹ˆë‹¤.`);
    lines.push(`ìë™ì°¨ëŠ” ìì „ê±° ëŒ€ë¹„ êµí†µì•½ìì— í•´ë‹¹í•˜ëŠ” ìì „ê±°ì— ëŒ€í•œ ì£¼ì˜ì˜ë¬´ê°€ ê°€ì¤‘ë©ë‹ˆë‹¤.`);
  }else{
    lines.push(`ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨ì€ ${r.labelA} ${d.bf.a}% : ${r.labelB} ${d.bf.b}%ì…ë‹ˆë‹¤.`);
    if(d.bf.b>=90)lines.push(`${r.labelB}ì¸¡ì˜ ê³¼ì‹¤ì´ ì••ë„ì ìœ¼ë¡œ ë†’ì€ ê²ƒì€ ì¤‘ëŒ€í•œ êµí†µë²•ê·œ ìœ„ë°˜ì— ê¸°ì¸í•©ë‹ˆë‹¤.`);
    else if(Math.abs(d.bf.a-d.bf.b)<=20)lines.push(`ìŒë°© ê³¼ì‹¤ì´ ë¹„êµì  ê· í˜•ì ì¸ ê²ƒì€ ì–‘ì¸¡ ëª¨ë‘ ì£¼ì˜ì˜ë¬´ê°€ ìˆëŠ” ìƒí™©ì…ë‹ˆë‹¤.`);
  }

  // ìˆ˜ì •ìš”ì†Œ ë¶„ì„
  if(r.mods?.length>0){
    lines.push(`ìˆ˜ì •ìš”ì†Œë¡œ ${r.mods.join(', ')}ì´(ê°€) ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    r.mods.forEach(m=>{
      const mdb=MODS_DB.find(x=>x.name===m);
      if(mdb)lines.push(`- ${m}: ${mdb.desc} (ì¼ë°˜ì  ì¡°ì •í­ ${mdb.adj>0?'+':''}${mdb.adj}%)`);
    });
    lines.push(`ìˆ˜ì •ìš”ì†Œë¥¼ ë°˜ì˜í•œ ìµœì¢… ê³¼ì‹¤ë¹„ìœ¨ì€ ${r.labelA} ${r.faultA}% : ${r.labelB} ${r.faultB}%ë¡œ ì‚°ì •ë©ë‹ˆë‹¤.`);
  }else{
    lines.push(`ë³„ë„ì˜ ìˆ˜ì •ìš”ì†Œê°€ ê°ì§€ë˜ì§€ ì•Šì•„ ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨ì´ ìµœì¢… ë¹„ìœ¨ë¡œ ì ìš©ë©ë‹ˆë‹¤.`);
  }

  return lines.join('\n');
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 3 â€” UTILITIES (PDFÂ·OCRÂ·ì˜ìƒÂ·KB)                      â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ PDF TEXT EXTRACTION â”€â”€ */
async function extractPDFText(file,onStatus,onProgress,maxPages=20){
  if(!window.pdfjsLib)throw new Error("PDF.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ");
  onStatus?.("PDF íŒŒì¼ ì½ëŠ” ì¤‘...");onProgress?.(5);
  const buf=await file.arrayBuffer();
  onStatus?.("PDF íŒŒì‹± ì¤‘...");onProgress?.(10);
  const pdf=await window.pdfjsLib.getDocument({data:buf}).promise;
  const n=Math.min(pdf.numPages,maxPages);
  onStatus?.(`ì´ ${pdf.numPages}í˜ì´ì§€ ê°ì§€ (${n}í˜ì´ì§€ ì²˜ë¦¬)`);onProgress?.(15);
  let allText='';
  for(let i=1;i<=n;i++){
    onStatus?.(`í˜ì´ì§€ ${i}/${n} í…ìŠ¤íŠ¸ ì¶”ì¶œ...`);
    onProgress?.(15+Math.round((i/n)*80));
    const page=await pdf.getPage(i);
    const tc=await page.getTextContent();
    const pt=tc.items.map(it=>it.str).join(' ');
    if(pt.trim())allText+=`\n[p${i}] ${pt.trim()}`;
  }
  onProgress?.(98);
  return{text:allText.trim(),totalPages:pdf.numPages,extracted:n};
}

/* â”€â”€ PDF â†’ Image for OCR fallback â”€â”€ */
async function renderPDFToImages(file,onStatus,onProgress,maxPages=5){
  if(!window.pdfjsLib)throw new Error("PDF.js ì—†ìŒ");
  const buf=await file.arrayBuffer();
  const pdf=await window.pdfjsLib.getDocument({data:buf}).promise;
  const n=Math.min(pdf.numPages,maxPages);
  const imgs=[];
  for(let i=1;i<=n;i++){
    onStatus?.(`í˜ì´ì§€ ${i}/${n} ì´ë¯¸ì§€ ë Œë”ë§...`);
    onProgress?.(Math.round((i/n)*90));
    const page=await pdf.getPage(i);
    const vp=page.getViewport({scale:2});
    const cv=document.createElement('canvas');
    cv.width=vp.width;cv.height=vp.height;
    const ctx=cv.getContext('2d');
    ctx.fillStyle='#fff';ctx.fillRect(0,0,cv.width,cv.height);
    await page.render({canvasContext:ctx,viewport:vp}).promise;
    imgs.push(cv.toDataURL('image/png'));
  }
  return imgs;
}

/* â”€â”€ OCR (Tesseract.js v5) â”€â”€ */
function loadScript(url,timeout=15000){
  return new Promise((ok,fail)=>{
    if(document.querySelector(`script[src="${url}"]`)&&window.Tesseract){ok();return}
    const s=document.createElement('script');s.src=url;s.async=true;
    const t=setTimeout(()=>{s.remove();fail(new Error('timeout'))},timeout);
    s.onload=()=>{clearTimeout(t);setTimeout(ok,400)};s.onerror=()=>{clearTimeout(t);s.remove();fail(new Error('failed'))};
    document.head.appendChild(s);
  });
}
async function ensureTesseract(){
  if(window.Tesseract)return true;
  for(const u of["https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js","https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"]){
    try{await loadScript(u);if(window.Tesseract)return true}catch(e){}
  }
  return false;
}
function imgToCanvas(src){
  return new Promise((ok,fail)=>{
    const img=new Image();img.crossOrigin='anonymous';
    img.onload=()=>{const c=document.createElement('canvas');c.width=Math.min(img.width,2000);c.height=Math.round(img.height*(c.width/img.width));const x=c.getContext('2d');x.fillStyle='#fff';x.fillRect(0,0,c.width,c.height);x.drawImage(img,0,0,c.width,c.height);ok(c.toDataURL('image/png'))};
    img.onerror=()=>fail(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
    if(typeof src==='string')img.src=src;
    else{const r=new FileReader();r.onload=e=>{img.src=e.target.result};r.onerror=()=>fail(new Error('íŒŒì¼ì½ê¸°ì‹¤íŒ¨'));r.readAsDataURL(src)}
  });
}
async function runOCR(imgSrc,onStatus,onProgress){
  onStatus?.("Tesseract.js ë¡œë”©...");onProgress?.(5);
  if(!await ensureTesseract())throw new Error("Tesseract.js ë¡œë”© ì‹¤íŒ¨");
  onStatus?.("ì´ë¯¸ì§€ ì „ì²˜ë¦¬...");onProgress?.(10);
  const du=await imgToCanvas(imgSrc);
  onStatus?.("OCR ì›Œì»¤ ìƒì„± + í•œêµ­ì–´ ë°ì´í„°...");onProgress?.(15);
  let w;
  try{
    w=await window.Tesseract.createWorker("kor+eng",1,{logger:m=>{
      if(m.status==='loading language traineddata'){onStatus?.(`í•œêµ­ì–´ ë°ì´í„° ${Math.round((m.progress||0)*100)}%`);onProgress?.(20+Math.round((m.progress||0)*35))}
      else if(m.status==='recognizing text'){onStatus?.(`í…ìŠ¤íŠ¸ ì¸ì‹ ${Math.round((m.progress||0)*100)}%`);onProgress?.(60+Math.round((m.progress||0)*35))}
    }});
  }catch(e){
    try{w=await window.Tesseract.createWorker("eng",1,{})}catch(e2){throw new Error(`OCRì—”ì§„ ìƒì„± ì‹¤íŒ¨`)}
  }
  const r=await w.recognize(du);
  await w.terminate().catch(()=>{});
  return{text:(r?.data?.text||'').trim(),confidence:Math.round(r?.data?.confidence||0)};
}

/* â”€â”€ Video Env â”€â”€ */
function grabFrames(v,n,onMsg){return new Promise((ok,fail)=>{
  const d=v.duration;if(!d||!isFinite(d))return fail(new Error("ì˜ìƒê¸¸ì´ ì˜¤ë¥˜"));
  const cv=document.createElement('canvas'),ctx=cv.getContext('2d'),fr=[],ts=[];
  for(let i=1;i<=n;i++)ts.push(Math.max(.1,Math.min(d-.05,(d/(n+1))*i)));
  let idx=0;const sf=setTimeout(()=>ok(fr),12000);
  function nx(){if(idx>=ts.length){clearTimeout(sf);ok(fr);return}onMsg?.(`í”„ë ˆì„ ${idx+1}/${n}`);v.currentTime=ts[idx]}
  v.onseeked=()=>{try{cv.width=v.videoWidth||640;cv.height=v.videoHeight||360;ctx.drawImage(v,0,0,cv.width,cv.height);fr.push({time:ts[idx],url:cv.toDataURL('image/jpeg',.7)})}catch(e){}idx++;nx()};
  v.onerror=()=>{clearTimeout(sf);fail(new Error("í”„ë ˆì„ ì˜¤ë¥˜"))};nx();
})}
function analyzeEnv(du){return new Promise(ok=>{
  const img=new Image();img.onload=()=>{try{
    const cv=document.createElement('canvas'),ctx=cv.getContext('2d'),sw=Math.min(img.width,480),sh=Math.round(img.height*(sw/img.width));
    cv.width=sw;cv.height=sh;ctx.drawImage(img,0,0,sw,sh);const px=ctx.getImageData(0,0,sw,sh).data;
    let tb=0,dk=0,rp=0,gp=0,yp=0,rpAll=0,gpAll=0,ypAll=0,n=0;
    for(let i=0;i<px.length;i+=8){const r=px[i],g=px[i+1],b=px[i+2],l=r*.299+g*.587+b*.114;tb+=l;n++;if(l<45)dk++;
      const isRed=r>180&&g<100&&b<100,isGreen=g>180&&r<100&&b<100,isYellow=r>180&&g>150&&b<80;
      if(isRed)rpAll++;if(isGreen)gpAll++;if(isYellow)ypAll++;
      const py=Math.floor((i/4)/sw);if(py<sh*.6){if(isRed)rp++;if(isGreen)gp++;if(isYellow)yp++}}
    const avg=Math.round(tb/n),st=Math.max(3,n*.0002);
    ok({brightness:avg,isNight:avg<80||dk/n>.55,label:avg<65?"ì•¼ê°„":avg<95?"ìƒˆë²½/ì•¼ê°„":"ì£¼ê°„",
      red:rp>st||rpAll>st*2,green:gp>st||gpAll>st*2,yellow:yp>st||ypAll>st*2,
      redCount:rpAll,greenCount:gpAll,yellowCount:ypAll})
  }catch(e){ok({brightness:128,isNight:false,label:"ì˜¤ë¥˜",red:false,green:false,yellow:false,redCount:0,greenCount:0,yellowCount:0})}};
  img.onerror=()=>ok({brightness:128,isNight:false,label:"ì˜¤ë¥˜",red:false,green:false,yellow:false,redCount:0,greenCount:0,yellowCount:0});img.src=du;
})}

/* â”€â”€ Knowledge Base â”€â”€ */
const KB_KEY='mdlabs_kb_v4';
function loadKB(){return SEC.safeJSON(KB_KEY,[])}
function saveKB(kb){SEC.safeStore(KB_KEY,kb,200)}
function parsePrecedent(rawText){
  const text=SEC.validateText(rawText,5000);
  const r={id:'P'+Date.now().toString(36)+Math.random().toString(36).slice(2,5),rawText:text.slice(0,3000),caseNumber:null,court:null,date:null,accidentType:'ì°¨ëŒ€ì°¨',faultA:50,faultB:50,keywords:[],legalBasis:[],keyFacts:[],summary:'',confidence:25,verified:false,createdAt:new Date().toISOString()};
  for(const p of[/(\d{4}[ê°€-í£]+\d{3,})/,/ì‚¬ê±´[ë²ˆí˜¸:\s]*([^\n,]{5,25})/]){const m=text.match(p);if(m){r.caseNumber=m[1].trim();r.confidence+=15;break}}
  for(const c of['ëŒ€ë²•ì›','ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›','ì„œìš¸ê³ ë“±ë²•ì›','ìˆ˜ì›ì§€ë°©ë²•ì›','ì¸ì²œì§€ë°©ë²•ì›','ëŒ€ì „ì§€ë°©ë²•ì›','ë¶€ì‚°ì§€ë°©ë²•ì›']){if(text.includes(c)){r.court=c;r.confidence+=10;break}}
  const dm=text.match(/(\d{4})[.\-\/ë…„]\s*(\d{1,2})[.\-\/ì›”]\s*(\d{1,2})/);
  if(dm){r.date=`${dm[1]}-${dm[2].padStart(2,'0')}-${dm[3].padStart(2,'0')}`;r.confidence+=5}
  if(/ë³´í–‰ì|íš¡ë‹¨ë³´ë„.*ë³´í–‰/.test(text))r.accidentType='ì°¨ëŒ€ì‚¬ëŒ';
  else if(/ìì „ê±°|ì´ë¥œ|ì˜¤í† ë°”ì´/.test(text))r.accidentType='ì°¨ëŒ€ìì „ê±°';
  const fm=text.match(/ê³¼ì‹¤[ë¹„ìœ¨:\s]*(\d{1,3})\s*[:%]\s*(\d{1,3})/)||text.match(/(\d{1,3})\s*[:%ëŒ€]\s*(\d{1,3})\s*(?:ê³¼ì‹¤|ë¹„ìœ¨)/);
  if(fm){const a=+fm[1],b=+fm[2];if(a+b>=90&&a+b<=110){r.faultA=Math.round(a/(a+b)*100);r.faultB=100-r.faultA;r.confidence+=20}}
  ['ì‹ í˜¸ìœ„ë°˜','ì¤‘ì•™ì„ ì¹¨ë²”','ì°¨ì„ ë³€ê²½','ì¶”ëŒ','íš¡ë‹¨ë³´ë„','ê³¼ì†','ìŒì£¼','ì•ˆì „ê±°ë¦¬','ê¸‰ì œë™','ë¹„ë³´í˜¸ì¢ŒíšŒì „','ìš°íšŒì „','ìœ í„´','ì—­ì£¼í–‰','ë³´í–‰ì','ìì „ê±°','êµì°¨ë¡œ','ê³ ì†ë„ë¡œ','ì£¼ì°¨ì¥','ì•¼ê°„','ìš°ì²œ','ì–´ë¦°ì´','ë…¸ì¸','ì§ì§„','ì¢ŒíšŒì „','ìš°íšŒì „','ë¼ì–´ë“¤ê¸°','í•©ë¥˜','í›„ì§„'].forEach(k=>{if(text.includes(k))r.keywords.push(k)});
  if(r.keywords.length>=2)r.confidence+=10;
  const laws=new Set();let lm;const re=/(?:ë„ë¡œêµí†µë²•|ë¯¼ë²•|ìë™ì°¨ì†í•´ë°°ìƒë³´ì¥ë²•|êµí†µì‚¬ê³ ì²˜ë¦¬íŠ¹ë¡€ë²•)\s*ì œ?\s*\d+ì¡°?/g;
  while((lm=re.exec(text)))laws.add(lm[0]);r.legalBasis=[...laws].slice(0,6);
  r.keyFacts=text.split(/[.ã€‚\n]/).filter(s=>s.trim().length>15&&s.length<200).filter(s=>['ì‚¬ê³ ','ì¶©ëŒ','íš¡ë‹¨','ì§ì§„','ì¶”ëŒ','ì°¨ì„ ','ì‹ í˜¸','ê³¼ì‹¤','í”¼í•´'].some(k=>s.includes(k))).slice(0,4).map(s=>s.trim());
  r.summary=[r.caseNumber,r.court,r.accidentType,`${r.faultA}:${r.faultB}`].filter(Boolean).join(' Â· ');
  r.confidence=Math.min(95,r.confidence);return r;
}
function findSimilar(text,kb,max=5){
  if(!kb.length)return[];
  const kw=[];
  ['ì°¨ì„ ë³€ê²½','ì¶”ëŒ','íš¡ë‹¨ë³´ë„','ê³¼ì†','ìŒì£¼','ì•ˆì „ê±°ë¦¬','ê¸‰ì œë™','ë¹„ë³´í˜¸ì¢ŒíšŒì „','ìš°íšŒì „','ìœ í„´','ì—­ì£¼í–‰','ë³´í–‰ì','ìì „ê±°','êµì°¨ë¡œ','ì£¼ì°¨ì¥','ì•¼ê°„','í›„ì§„','ì¤‘ì•™ì„ ì¹¨ë²”','ì§ì§„','ì¢ŒíšŒì „','í•©ë¥˜'].forEach(k=>{if(text.includes(k))kw.push(k)});
  let type='ì°¨ëŒ€ì°¨';if(/ë³´í–‰ì|ì‚¬ëŒ/.test(text))type='ì°¨ëŒ€ì‚¬ëŒ';else if(/ìì „ê±°|ì´ë¥œ/.test(text))type='ì°¨ëŒ€ìì „ê±°';
  return kb.map(c=>{let s=0;if(c.accidentType===type)s+=30;(c.keywords||[]).forEach(k=>{if(kw.includes(k))s+=15});if(c.verified)s+=15;return{...c,matchScore:s}}).filter(x=>x.matchScore>=20).sort((a,b)=>b.matchScore-a.matchScore).slice(0,max);
}

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 4 â€” UI COMPONENTS                                    â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const STEPS=[
  {id:"upload",icon:"ğŸ“",label:"ìë£Œ ì…ë ¥",desc:"í…ìŠ¤íŠ¸Â·íŒŒì¼ í™•ì¸"},
  {id:"pdf",icon:"ğŸ“„",label:"PDF ë¶„ì„",desc:"PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ"},
  {id:"ocr",icon:"ğŸ”",label:"OCR ë¶„ì„",desc:"ì´ë¯¸ì§€â†’í…ìŠ¤íŠ¸ ë³€í™˜"},
  {id:"video",icon:"ğŸ¬",label:"ì˜ìƒ í™˜ê²½ë¶„ì„",desc:"ì£¼ì•¼ê°„Â·ì‹ í˜¸ ì¶”ì¶œ"},
  {id:"match",icon:"ğŸ“‹",label:"ë„í‘œ ë§¤ì¹­",desc:"ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€ ê²€ìƒ‰"},
  {id:"similar",icon:"ğŸ§ ",label:"íŒë¡€ ê²€ìƒ‰",desc:"ìœ ì‚¬ íŒë¡€ ë¹„êµ"},
  {id:"result",icon:"âš–ï¸",label:"ê²°ê³¼ ì‚°ì¶œ",desc:"ê³¼ì‹¤ë¹„ìœ¨+ë²•ì ê·¼ê±°"},
];

function AgentPipeline({stepStates}){
  return<div style={{background:"rgba(8,12,24,.6)",border:"1px solid rgba(99,102,241,.1)",borderRadius:16,padding:"14px 16px",marginBottom:14}}>
    <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:12}}>
      <div style={{width:7,height:7,borderRadius:4,background:Object.values(stepStates).some(s=>s.status==='running')?"#6366f1":"#1e293b",animation:Object.values(stepStates).some(s=>s.status==='running')?"pulse 1.2s infinite":"none"}}/>
      <span style={{fontSize:10,fontWeight:700,color:"#94a3b8",letterSpacing:1}}>AI AGENT PIPELINE</span>
      <span style={{fontSize:9,color:"#475569",marginLeft:"auto"}}>v7.0</span>
    </div>
    {STEPS.map((step,i)=>{const st=stepStates[step.id]||{status:'idle'};const isRun=st.status==='running',isDone=st.status==='done',isErr=st.status==='error',isSkip=st.status==='skip';
    return<div key={step.id}>
      <div style={{display:"flex",alignItems:"center",gap:8,padding:"7px 8px",borderRadius:9,background:isRun?"rgba(99,102,241,.06)":"transparent",border:isRun?"1px solid rgba(99,102,241,.12)":"1px solid transparent",transition:"all .3s"}}>
        <div style={{width:28,height:28,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,flexShrink:0,
          background:isDone?"rgba(16,185,129,.08)":isErr?"rgba(239,68,68,.08)":isRun?"rgba(99,102,241,.1)":"rgba(15,23,42,.3)",
          border:`1px solid ${isDone?"rgba(16,185,129,.18)":isErr?"rgba(239,68,68,.18)":isRun?"rgba(99,102,241,.2)":"rgba(30,41,59,.4)"}`}}>
          {isRun?<div style={{width:12,height:12,border:"2px solid #6366f140",borderTopColor:"#6366f1",borderRadius:6,animation:"spin .7s linear infinite"}}/>:isDone?"âœ…":isErr?"âŒ":isSkip?"â­ï¸":step.icon}
        </div>
        <div style={{flex:1,minWidth:0}}>
          <div style={{fontSize:11,fontWeight:isRun?700:isDone?600:500,color:isDone?"#10b981":isErr?"#ef4444":isRun?"#e2e8f0":"#475569"}}>{step.label}</div>
          <div style={{fontSize:9.5,color:isRun?"#94a3b8":"#334155",marginTop:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{st.msg||step.desc}</div>
        </div>
        {isRun&&typeof st.progress==='number'&&st.progress>0&&<span style={{fontSize:10,fontWeight:800,fontFamily:"var(--mono)",color:"#818cf8"}}>{Math.round(st.progress)}%</span>}
        {isDone&&<span style={{fontSize:9,color:"#10b981",fontWeight:600}}>ì™„ë£Œ</span>}
      </div>
      {isRun&&typeof st.progress==='number'&&st.progress>0&&<div style={{margin:"1px 40px 3px",height:2.5,borderRadius:2,background:"#1e293b",overflow:"hidden"}}><div style={{height:"100%",borderRadius:2,background:"linear-gradient(90deg,#6366f1,#3b82f6)",transition:"width .4s",width:`${Math.min(100,st.progress)}%`}}/></div>}
      {i<STEPS.length-1&&<div style={{marginLeft:22,width:1,height:3,background:"#1e293b"}}/>}
    </div>})}
  </div>;
}

const C={bg:"#050810",card:"rgba(12,17,30,.82)",b1:"rgba(148,163,184,.08)",b2:"rgba(148,163,184,.18)",t1:"#f1f5f9",t2:"#94a3b8",t3:"#64748b",blue:"#3b82f6",indigo:"#6366f1",violet:"#8b5cf6",emerald:"#10b981",amber:"#f59e0b",red:"#ef4444",cyan:"#06b6d4"};
const Tag=({children,color=C.indigo,sx})=><span style={{display:"inline-flex",padding:"3px 9px",borderRadius:7,fontSize:10.5,fontWeight:600,background:`${color}15`,color,border:`1px solid ${color}25`,...sx}}>{children}</span>;
const Btn=({children,onClick,primary,disabled,small,sx})=><button onClick={onClick} disabled={disabled} style={{padding:small?"6px 14px":"11px 22px",borderRadius:small?8:12,border:primary?"none":`1px solid ${C.b2}`,background:disabled?"#1e293b":primary?`linear-gradient(135deg,${C.blue},${C.violet})`:"rgba(30,41,59,.5)",color:disabled?"#475569":primary?"#fff":C.t2,fontSize:small?11:13,fontWeight:600,cursor:disabled?"not-allowed":"pointer",transition:"all .25s",...sx}}>{children}</button>;
const FBar=({la,lb,va,vb})=>{const[on,s]=useState(false);useEffect(()=>{s(false);setTimeout(()=>s(true),300)},[va,vb]);
return<div style={{margin:"12px 0"}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:5}}><span style={{fontFamily:"var(--mono)",fontWeight:800,fontSize:12,color:C.blue}}>{la} {va}%</span><span style={{fontFamily:"var(--mono)",fontWeight:800,fontSize:12,color:C.red}}>{lb} {vb}%</span></div><div style={{display:"flex",height:40,borderRadius:20,overflow:"hidden",background:"#0c1222",border:`1px solid ${C.b1}`}}><div style={{display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg,#1d4ed8,${C.blue})`,color:"#fff",fontWeight:800,fontSize:13,fontFamily:"var(--mono)",transition:"width 1.2s cubic-bezier(.16,1,.3,1)",width:on?`${va}%`:"0%",minWidth:va>0?38:0}}>{va>8&&`${va}%`}</div><div style={{display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg,${C.red},#b91c1c)`,color:"#fff",fontWeight:800,fontSize:13,fontFamily:"var(--mono)",transition:"width 1.2s cubic-bezier(.16,1,.3,1)",width:on?`${vb}%`:"0%",minWidth:vb>0?38:0}}>{vb>8&&`${vb}%`}</div></div></div>};

/* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
   â•‘  LAYER 5 â€” MAIN APP                                         â•‘
   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â• ì„œë²„ API ì—°ë™ â•â•â• */
const API_BASE=window.location.origin;
const SESSION_ID=(()=>{let s=sessionStorage.getItem('mdl_sid');if(!s){s='s-'+Date.now()+'-'+Math.random().toString(36).slice(2,8);sessionStorage.setItem('mdl_sid',s)}return s})();

async function saveToServer(data){
  try{
    const res=await fetch(API_BASE+'/api/save',{method:'POST',headers:{'Content-Type':'application/json','X-Session-ID':SESSION_ID},body:JSON.stringify({...data,session_id:SESSION_ID})});
    if(!res.ok)return null;
    return await res.json();
  }catch(e){console.warn('ì„œë²„ ì €ì¥ ì‹¤íŒ¨:',e);return null}
}
async function sendFeedback(analysisId,isCorrect,comment){
  try{
    const res=await fetch(API_BASE+'/api/feedback',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({analysis_id:analysisId,is_correct:isCorrect,comment:comment||''})});
    if(!res.ok)return null;
    return await res.json();
  }catch(e){console.warn('í”¼ë“œë°± ì €ì¥ ì‹¤íŒ¨:',e);return null}
}
async function savePrecedentToServer(entry,diagramId,category){
  try{
    const res=await fetch(API_BASE+'/api/precedents',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      case_number:entry.caseNumber||'',court:entry.court||'',date:entry.date||null,
      category:category||entry.accidentType||'ì°¨ëŒ€ì°¨',subcategory:'',diagram_id:diagramId||null,
      fault_a:entry.faultA,fault_b:entry.faultB,keywords:entry.keywords||[],
      legal_basis:entry.legalBasis||[],key_facts:entry.keyFacts||[],
      summary:(entry.summary||entry.rawText||'').slice(0,5000),source:'user',confidence:entry.confidence||25
    })});
    if(!res.ok)return null;
    return await res.json();
  }catch(e){console.warn('íŒë¡€ ì„œë²„ ì €ì¥ ì‹¤íŒ¨:',e);return null}
}
async function callClaudeAPI(text,diagramList){
  try{
    const res=await fetch(API_BASE+'/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text,diagramList,mode:'match',sessionId:SESSION_ID})});
    if(!res.ok)return null;
    return await res.json();
  }catch(e){console.warn('Claude API í˜¸ì¶œ ì‹¤íŒ¨:',e);return null}
}
async function callClaudeReport(analysisData){
  try{
    const res=await fetch(API_BASE+'/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:analysisData.input_text||'ë¶„ì„',mode:'report',analysisData,sessionId:SESSION_ID})});
    if(!res.ok)return null;
    return await res.json();
  }catch(e){console.warn('Claude ê°ì •ì„œ ìƒì„± ì‹¤íŒ¨:',e);return null}
}

function App(){
  const[kb,setKb]=useState(()=>loadKB());
  const[input,setInput]=useState("");
  const[files,setFiles]=useState([]);
  const[pdfText,setPdfText]=useState("");
  const[ocrResult,setOcrResult]=useState(null);
  const[vidSrc,setVidSrc]=useState(null);
  const[vidEnv,setVidEnv]=useState(null);
  const[vidFrames,setVidFrames]=useState([]);
  const vidRef=useRef(null);
  const[result,setResult]=useState(null);
  const[running,setRunning]=useState(false);
  const[page,setPage]=useState("input");
  const[showKB,setShowKB]=useState(false);
  const[showReport,setShowReport]=useState(false);
  const taRef=useRef(null);
  const[stepStates,setStepStates]=useState({});
  const[savedId,setSavedId]=useState(null);
  const[fbSent,setFbSent]=useState(false);
  const[llmResult,setLlmResult]=useState(null);
  const[llmLoading,setLlmLoading]=useState(false);
  const setStep=(id,status,progress,msg)=>setStepStates(p=>({...p,[id]:{status,progress:progress??p[id]?.progress,msg:msg??p[id]?.msg}}));
  const resetSteps=()=>setStepStates({});
  const mx={maxWidth:900,margin:"0 auto",padding:"0 16px"};
  const stats=useMemo(()=>({total:kb.length,verified:kb.filter(c=>c.verified).length}),[kb]);
  const addToKB=(entry,diagramId,category)=>{const n=[entry,...kb];setKb(n);saveKB(n);savePrecedentToServer(entry,diagramId,category).catch(()=>{})};
  const removeFromKB=id=>{const n=kb.filter(c=>c.id!==id);setKb(n);saveKB(n)};

  function checkPDF(f){
    if(!f)return false;
    if(f.type==='application/pdf')return true;
    return(f.name||'').toLowerCase().endsWith('.pdf');
  }
  const addFiles=fl=>{
    const arr=Array.from(fl).map(f=>{
      const check=SEC.validateFile(f);
      if(!check.ok){alert(check.reason);return null}
      const pdf=checkPDF(f);
      return{file:f,name:SEC.sanitize(f.name||'unknown'),type:f.type||'',size:f.size||0,preview:null,id:Date.now()+'-'+Math.random().toString(36).slice(2),pdf};
    }).filter(Boolean);
    arr.forEach(nf=>{
      if(nf.type.startsWith('image/')){const r=new FileReader();r.onload=e=>{nf.preview=e.target.result;setFiles(p=>[...p])};r.readAsDataURL(nf.file)}
      if(nf.type.startsWith('video/')){setVidSrc(URL.createObjectURL(nf.file));setVidFrames([]);setVidEnv(null)}
    });
    setFiles(p=>[...p,...arr]);
  };

  // â•â•â• FULL ANALYSIS â•â•â•
  const runAnalysis=useCallback(async()=>{
    if(running)return;
    const safeInput=SEC.validateText(input);
    const hasText=safeInput.trim().length>=5;
    const hasPDF=files.some(f=>f.pdf===true||checkPDF(f.file));
    const hasImage=files.some(f=>f.type?.startsWith('image/'));
    const hasVideo=!!vidSrc;
    if(!hasText&&!hasPDF&&!hasImage&&!hasVideo)return;
    setRunning(true);setResult(null);setPdfText("");setOcrResult(null);resetSteps();
    let combined=safeInput.trim();

    // Step 1
    setStep("upload","done",100,"ì…ë ¥ í™•ì¸ ì™„ë£Œ"+(hasPDF?" Â· PDFê°ì§€":"")+(hasImage?" Â· ì´ë¯¸ì§€":"")+(hasVideo?" Â· ì˜ìƒ":""));
    await new Promise(r=>setTimeout(r,200));

    // Step 2: PDF
    if(hasPDF){
      setStep("pdf","running",0,"PDF í…ìŠ¤íŠ¸ ì§ì ‘ ì¶”ì¶œ ì‹œì‘...");
      const pf=files.find(f=>f.pdf===true||checkPDF(f.file));
      try{
        const pr=await extractPDFText(pf.file,msg=>setStep("pdf","running",null,msg),pct=>setStep("pdf","running",pct));
        if(pr.text&&pr.text.length>20){
          setPdfText(pr.text);combined=combined?combined+"\n\n[PDF ì¶”ì¶œ]\n"+pr.text:pr.text;
          setStep("pdf","done",100,`${pr.text.length}ì ì¶”ì¶œ (${pr.extracted}/${pr.totalPages}í˜ì´ì§€)`);
        }else{
          setStep("pdf","running",50,"í…ìŠ¤íŠ¸ ì—†ìŒ â†’ ì´ë¯¸ì§€ OCR ì‹œë„...");
          try{
            const imgs=await renderPDFToImages(pf.file,msg=>setStep("pdf","running",null,msg),pct=>setStep("pdf","running",50+pct*0.2));
            if(imgs.length>0&&await ensureTesseract()){
              let ocrText='';
              for(let i=0;i<imgs.length;i++){setStep("pdf","running",70+Math.round((i/imgs.length)*25),`í˜ì´ì§€ ${i+1} OCR...`);
                try{const r=await runOCR(imgs[i],null,null);if(r.text)ocrText+=`\n[p${i+1}] ${r.text}`}catch(e){}}
              if(ocrText.length>10){setPdfText(ocrText);combined+="\n\n[PDF OCR]\n"+ocrText;setStep("pdf","done",100,`OCR ${ocrText.length}ì ì¶”ì¶œ`)}
              else setStep("pdf","done",100,"í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹¤íŒ¨");
            }else{setStep("pdf","done",100,"ì´ë¯¸ì§€ PDF â€” OCR ë¶ˆê°€")}
          }catch(e2){setStep("pdf","error",null,e2.message)}
        }
      }catch(e){setStep("pdf","error",null,e.message)}
      await new Promise(r=>setTimeout(r,200));
    }else{setStep("pdf","skip",null,"PDF ì—†ìŒ")}

    // Step 3: OCR
    if(hasImage){
      setStep("ocr","running",0,"ì´ë¯¸ì§€ OCR...");
      const img=files.find(f=>f.type?.startsWith('image/'));
      try{
        const res=await runOCR(img.file,msg=>setStep("ocr","running",null,msg),pct=>setStep("ocr","running",pct));
        if(res.text?.length>3){setOcrResult(res);combined+="\n\n[OCR]\n"+res.text;setStep("ocr","done",100,`${res.text.length}ì Â· ì‹ ë¢°ë„${res.confidence}%`)}
        else setStep("ocr","done",100,"í…ìŠ¤íŠ¸ ì—†ìŒ");
      }catch(e){setStep("ocr","error",null,e.message)}
      await new Promise(r=>setTimeout(r,200));
    }else{setStep("ocr","skip",null,"ì´ë¯¸ì§€ ì—†ìŒ")}

    // Step 4: Video
    if(hasVideo&&vidRef.current){
      setStep("video","running",0,"í”„ë ˆì„ ì¶”ì¶œ...");
      try{
        const fr=await grabFrames(vidRef.current,10,msg=>setStep("video","running",null,msg));
        setVidFrames(fr);
        if(fr.length>0){
          const envs=[];for(let i=0;i<fr.length;i++){setStep("video","running",Math.round((i/fr.length)*80+20));envs.push(await analyzeEnv(fr[i].url))}
          const nightN=envs.filter(e=>e.isNight).length,avgBr=Math.round(envs.reduce((s,e)=>s+e.brightness,0)/envs.length);
          const env={perFrame:envs,timeOfDay:nightN>fr.length/2?"ì•¼ê°„":"ì£¼ê°„",avgBr,
            hasRed:envs.some(e=>e.red),hasGreen:envs.some(e=>e.green),hasYellow:envs.some(e=>e.yellow),
            redTotal:envs.reduce((s,e)=>s+(e.redCount||0),0),greenTotal:envs.reduce((s,e)=>s+(e.greenCount||0),0),
            yellowTotal:envs.reduce((s,e)=>s+(e.yellowCount||0),0)};
          setVidEnv(env);
          let et=`\n[ì˜ìƒí™˜ê²½: ${env.timeOfDay} ë°ê¸°${avgBr}]`;
          if(env.hasRed||env.hasGreen||env.hasYellow){
            et+=" êµì°¨ë¡œ ì‹ í˜¸";
            if(env.hasRed)et+=" ì ìƒ‰ ì ìƒ‰ì‹ í˜¸";
            if(env.hasGreen)et+=" ë…¹ìƒ‰ ë…¹ìƒ‰ì‹ í˜¸ ì§ì§„";
            if(env.hasYellow)et+=" í™©ìƒ‰";
            if(env.hasRed&&env.hasGreen)et+=" ì‹ í˜¸ìœ„ë°˜ ì§ì§„ êµì°¨ë¡œì‚¬ê³ ";
          }
          if(env.timeOfDay==="ì•¼ê°„")et+=" ì•¼ê°„ ì•¼ê°„ì‚¬ê³ ";
          if(!safeInput.trim()){
            et+=" ì§ì§„ ì°¨ëŒ€ì°¨ ì¶©ëŒ ì‚¬ê³  êµì°¨ë¡œ";
            if(env.hasRed&&env.hasGreen)et+=" ë…¹ìƒ‰ì§ì§„ ì ìƒ‰ì§ì§„ ì‹ í˜¸êµì°¨ë¡œ";
            else if(env.hasRed)et+=" ì ìƒ‰ ì‹ í˜¸ìœ„ë°˜ êµì°¨ë¡œ";
            else if(env.hasGreen)et+=" ë…¹ìƒ‰ ì§ì§„ êµì°¨ë¡œ";
            else et+=" ë¬´ì‹ í˜¸";
          }
          combined+=et;
          setStep("video","done",100,`${env.timeOfDay} Â· ë°ê¸°${avgBr} ${env.hasRed?"ğŸ”´":""}${env.hasGreen?"ğŸŸ¢":""}${env.hasYellow?"ğŸŸ¡":""} ${!env.hasRed&&!env.hasGreen&&!env.hasYellow?"(ì‹ í˜¸ë¯¸ê°ì§€)":""}`);
        }
      }catch(e){setStep("video","error",null,e.message)}
      await new Promise(r=>setTimeout(r,200));
    }else{setStep("video","skip",null,"ì˜ìƒ ì—†ìŒ")}

    // Step 5: Diagram match
    if(combined.length<5){setStep("match","error",null,"í…ìŠ¤íŠ¸ ë¶€ì¡±");setRunning(false);return}
    setStep("match","running",40,`${DB.length}ê°œ ë„í‘œ ëŒ€ì¡° ì¤‘...`);
    await new Promise(r=>setTimeout(r,400));
    const m=matchDiagram(combined);
    if(!m){
      setStep("match","error",null,"ë§¤ì¹­ ë„í‘œ ì—†ìŒ");
      setResult({error:true,text:combined});setRunning(false);setPage("result");return;
    }
    setStep("match","done",100,`${m.match.id} Â· ${m.match.t} (ì ìˆ˜:${m.matchScore})`);
    await new Promise(r=>setTimeout(r,200));

    // Step 6: Similar
    setStep("similar","running",50,"ìœ ì‚¬ íŒë¡€ ê²€ìƒ‰...");
    await new Promise(r=>setTimeout(r,300));
    const sim=findSimilar(combined,kb);
    setStep("similar","done",100,sim.length?`${sim.length}ê±´`:"ì—†ìŒ");
    await new Promise(r=>setTimeout(r,150));

    // Step 7: Result
    setStep("result","running",60,"ê³¼ì‹¤ë¹„ìœ¨ ì‚°ì¶œ...");
    await new Promise(r=>setTimeout(r,400));
    const mods=detectMods(combined);
    const{fA,fB}=calcFault(m.match,mods);
    const isPed=m.match.bf.p!==undefined;
    const resultObj={diagram:m.match,confidence:m.confidence,matchScore:m.matchScore,alts:m.alts,faultA:fA,faultB:fB,
      labelA:m.match.la||(isPed?"ì°¨ëŸ‰":"A"),labelB:m.match.lb||(isPed?"ë³´í–‰ì":"B"),
      mods,appliedMods:(m.match.mods||[]).map(mod=>({...mod,applied:mods.some(dm=>mod.n.includes(dm)||dm.includes(mod.n))})),
      laws:getLaws(m.match,combined),similar:sim,text:combined};
    resultObj.analysis=generateAnalysis(resultObj,safeInput);
    setResult(resultObj);
    setSavedId(null);setFbSent(false);
    // â•â•â• ì„œë²„ ìë™ ì €ì¥ â•â•â•
    saveToServer({
      input_text:safeInput,input_type:hasPDF?'pdf':hasImage?'ocr':hasVideo?'video':'text',
      has_pdf:hasPDF,has_image:hasImage,has_video:hasVideo,
      pdf_text:pdfText,ocr_text:ocrResult?.text||'',video_env:vidEnv,
      diagram_id:m.match.id,diagram_title:m.match.t,category:m.match.cat,subcategory:m.match.sub,
      confidence:m.confidence,match_score:m.matchScore,alt_diagrams:m.alts,
      fault_a:fA,fault_b:fB,label_a:resultObj.labelA,label_b:resultObj.labelB,
      base_fault_a:isPed?m.match.bf.c:m.match.bf.a,base_fault_b:isPed?m.match.bf.p:m.match.bf.b,
      detected_mods:mods,applied_mods:resultObj.appliedMods,laws:resultObj.laws.map(l=>({a:l.a,d:l.d})),
      analysis_text:resultObj.analysis,llm_used:false
    }).then(res=>{if(res?.id)setSavedId(res.id)}).catch(()=>{});
    // â•â•â• Claude API ë³´ì¡° ë¶„ì„ (ë°±ê·¸ë¼ìš´ë“œ) â•â•â•
    setLlmResult(null);setLlmLoading(true);
    const diagramListStr=DB.map(d=>`${d.id}: ${d.t} (${d.cat}/${d.sub})`).join('\n');
    callClaudeAPI(combined,diagramListStr).then(cr=>{
      if(cr?.success&&cr.result){setLlmResult(cr.result);setLlmLoading(false)}
      else setLlmLoading(false);
    }).catch(()=>setLlmLoading(false));
    setStep("result","done",100,`${m.match.id} Â· ${fA}:${fB}`);
    setRunning(false);setPage("result");
  },[input,files,vidSrc,kb,running]);

  const examples=["í¸ë„ 2ì°¨ë¡œì—ì„œ 1ì°¨ë¡œ ì§ì§„ ì¤‘ 2ì°¨ë¡œ ì°¨ëŸ‰ì´ ê¹œë¹¡ì´ ì—†ì´ ì°¨ì„ ë³€ê²½í•˜ì—¬ ì¸¡ë©´ ì¶©ëŒ","íš¡ë‹¨ë³´ë„ ë…¹ìƒ‰ì‹ í˜¸ì— ë³´í–‰ì íš¡ë‹¨ ì¤‘ ìš°íšŒì „ ì°¨ëŸ‰ì— ì¶©ê²©","ë¬´ì‹ í˜¸ êµì°¨ë¡œì—ì„œ ì§ì§„ ì¤‘ ì¢Œì¸¡ ì¢ì€ ë„ë¡œì—ì„œ ë‚˜ì˜¨ ì°¨ëŸ‰ê³¼ ì¶©ëŒ","ì£¼ì°¨ì¥ í†µë¡œ ì§ì§„ ì¤‘ í›„ì§„ ì¶œì°¨ ì°¨ëŸ‰ê³¼ ì ‘ì´‰","ê³ ì†ë„ë¡œì—ì„œ ì•ì°¨ ê¸‰ì •ê±°ë¡œ ì¶”ëŒ","ë¹„ë³´í˜¸ì¢ŒíšŒì „ ì¤‘ ì§ì§„ ì°¨ëŸ‰ê³¼ êµì°¨ë¡œì—ì„œ ì¶©ëŒ","ì¤‘ì•™ì„  ì¹¨ë²” ì°¨ëŸ‰ê³¼ ì •ë©´ ì¶©ëŒ"];

  /* â•â•â•â•â•â•â•â•â•â•â• AI ê°ì •ì„œ â•â•â•â•â•â•â•â•â•â•â• */
  const genReportId=()=>'MDL-'+new Date().getFullYear()+'-'+String(new Date().getMonth()+1).padStart(2,'0')+'-'+Math.random().toString(36).slice(2,7).toUpperCase();
  const reportId=useMemo(()=>genReportId(),[result]);
  const now=new Date();
  const fmtDate=`${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ${now.getDate()}ì¼`;
  const fmtTime=`${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;

  function AIReport({r,pdfText,ocrResult,vidEnv,onClose}){
    if(!r||r.error)return null;
    const d=r.diagram;const printRef=useRef(null);

    const handlePrint=()=>{
      const w=window.open('','_blank','width=900,height=1200');
      if(!w)return;const el=printRef.current;if(!el)return;
      w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>AI ê°ì •ì„œ - ${SEC.sanitize(reportId)}</title>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        <style>
          *{margin:0;padding:0;box-sizing:border-box}
          body{font-family:'Noto Sans KR',sans-serif;color:#1a1a2e;background:#fff;padding:40px 50px;font-size:12px;line-height:1.8}
          .report-header{text-align:center;border-bottom:3px double #1a1a2e;padding-bottom:20px;margin-bottom:30px}
          .section{margin-bottom:22px}.section-title{font-size:14px;font-weight:800;color:#1a1a2e;border-left:4px solid #3b5998;padding-left:10px;margin-bottom:10px}
          .section-body{padding-left:14px;font-size:12px;line-height:2}
          .fault-bar{display:flex;height:32px;border-radius:16px;overflow:hidden;border:1px solid #ddd;margin:10px 0}
          .fault-bar-a{background:#3b5998;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px}
          .fault-bar-b{background:#c0392b;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px}
          table{width:100%;border-collapse:collapse;margin:8px 0;font-size:11px}
          th{background:#f0f0f5;padding:7px 10px;text-align:left;border:1px solid #ddd;font-weight:700}
          td{padding:7px 10px;border:1px solid #ddd;vertical-align:top}
          .law-item{padding:6px 10px;border-left:3px solid #3b5998;background:#f8f9ff;margin-bottom:6px;border-radius:0 4px 4px 0}
          .disclaimer{margin-top:30px;padding:14px;border:1px solid #e0e0e0;border-radius:6px;background:#fefefe;font-size:10px;color:#888;text-align:center;line-height:1.8}
          .stamp{display:inline-flex;flex-direction:column;align-items:center;justify-content:center;border:2px solid #3b5998;border-radius:50%;width:62px;height:62px;text-align:center;font-weight:900;font-size:10px;color:#3b5998;margin-top:10px;line-height:1.3}
          @media print{body{padding:20px 30px}@page{margin:15mm}}
        </style></head><body>`);
      w.document.write(el.innerHTML);
      w.document.write('</body></html>');
      w.document.close();setTimeout(()=>{w.print()},600);
    };

    const TS={hdr:{textAlign:"center",borderBottom:"3px double #1a1a2e",paddingBottom:20,marginBottom:28},
      sec:{marginBottom:24},st:{fontSize:14,fontWeight:800,borderLeft:"4px solid #3b5998",paddingLeft:10,marginBottom:10},
      sb:{paddingLeft:14},th:{background:"#f0f0f5",padding:"8px 12px",border:"1px solid #ddd",fontWeight:700},
      td:{padding:"8px 12px",border:"1px solid #ddd"}};

    return<div style={{position:"fixed",inset:0,zIndex:1000,background:"rgba(0,0,0,.85)",backdropFilter:"blur(8px)",overflowY:"auto",animation:"fadeUp .3s"}}>
      <div style={{maxWidth:860,margin:"20px auto",padding:"0 12px"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,position:"sticky",top:10,zIndex:10}}>
          <button onClick={onClose} style={{padding:"8px 16px",borderRadius:10,border:`1px solid ${C.b2}`,background:"rgba(15,23,42,.9)",color:C.t2,fontSize:12,fontWeight:600,cursor:"pointer",backdropFilter:"blur(10px)"}}>â† ëŒì•„ê°€ê¸°</button>
          <button onClick={handlePrint} style={{padding:"8px 18px",borderRadius:10,border:"none",background:`linear-gradient(135deg,${C.blue},${C.violet})`,color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer"}}>ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥</button>
        </div>
        <div ref={printRef} style={{background:"#fff",color:"#1a1a2e",borderRadius:12,padding:"clamp(24px,4vw,48px)",fontFamily:"'Noto Sans KR',sans-serif",fontSize:12,lineHeight:2,boxShadow:"0 8px 60px rgba(0,0,0,.5)"}}>

          {/* HEADER */}
          <div style={TS.hdr}>
            <div style={{fontSize:11,color:"#3b5998",fontWeight:700,letterSpacing:3,marginBottom:4}}>MD LABS AI ANALYSIS v7.0</div>
            <div style={{fontSize:"clamp(22px,4vw,28px)",fontWeight:900,letterSpacing:2}}>êµí†µì‚¬ê³  ê³¼ì‹¤ë¹„ìœ¨ AI ê°ì •ì„œ</div>
            <div style={{fontSize:12,color:"#666",marginTop:6}}>ì†í•´ë³´í—˜í˜‘íšŒ ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€ ê¸°ë°˜ AI ë¶„ì„ ë³´ê³ ì„œ</div>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:10.5,color:"#888",marginTop:14,padding:"0 10px"}}>
              <span>ë¬¸ì„œë²ˆí˜¸: <b style={{color:"#333"}}>{reportId}</b></span>
              <span>ë¶„ì„ì¼ì‹œ: <b style={{color:"#333"}}>{fmtDate} {fmtTime}</b></span>
            </div>
          </div>

          {/* 1. ì‚¬ê³  ê°œìš” */}
          <div style={TS.sec}><div style={TS.st}>ì œ1ì¥ ì‚¬ê³  ê°œìš”</div><div style={TS.sb}>
            <table style={{width:"100%",borderCollapse:"collapse",fontSize:11.5}}>
              <tbody>
                <tr><th style={{...TS.th,width:"25%"}}>ì‚¬ê³  ìœ í˜•</th><td style={TS.td}>{d.cat}</td>
                    <th style={{...TS.th,width:"25%"}}>ì„¸ë¶€ ë¶„ë¥˜</th><td style={TS.td}>{d.sub}</td></tr>
                <tr><th style={TS.th}>ì ìš© ë„í‘œ</th><td style={TS.td}><b>{d.id}</b> â€” {d.t}</td>
                    <th style={TS.th}>ë§¤ì¹­ ì‹ ë¢°ë„</th><td style={TS.td}>{r.confidence==="ìƒ"?"â– â– â–  ìƒ ("+r.matchScore+"ì )":r.confidence==="ì¤‘"?"â– â– â–¡ ì¤‘ ("+r.matchScore+"ì )":"â– â–¡â–¡ í•˜ ("+r.matchScore+"ì )"}</td></tr>
                <tr><th style={TS.th}>ë‹¹ì‚¬ì A</th><td style={TS.td}>{r.labelA}</td>
                    <th style={TS.th}>ë‹¹ì‚¬ì B</th><td style={TS.td}>{r.labelB}</td></tr>
              </tbody>
            </table>
            {input.trim()&&<div style={{marginTop:10,padding:10,background:"#f8f9ff",borderRadius:6,border:"1px solid #e8e8f0"}}>
              <div style={{fontSize:10,fontWeight:700,color:"#666",marginBottom:3}}>ì‚¬ê³  ìƒí™© ê¸°ìˆ </div>
              <div style={{fontSize:11.5,lineHeight:1.9,color:"#2c3e50"}}>{SEC.sanitize(input.trim())}</div>
            </div>}
          </div></div>

          {/* 2. ì¦ê±° ë¶„ì„ */}
          <div style={TS.sec}><div style={TS.st}>ì œ2ì¥ ì¦ê±°ìë£Œ ë¶„ì„</div><div style={TS.sb}>
            {pdfText&&<div style={{marginBottom:10}}>
              <div style={{fontSize:11,fontWeight:700,color:"#3b5998",marginBottom:4}}>2-1. PDF ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ</div>
              <div style={{padding:8,background:"#f5f5fa",borderRadius:6,border:"1px solid #e0e0e8",fontSize:10.5,lineHeight:1.7,maxHeight:120,overflow:"hidden",color:"#555"}}>{SEC.sanitize(pdfText.slice(0,800))}...</div>
            </div>}
            {ocrResult?.text&&<div style={{marginBottom:10}}>
              <div style={{fontSize:11,fontWeight:700,color:"#3b5998",marginBottom:4}}>OCR ë¶„ì„ (ì‹ ë¢°ë„ {ocrResult.confidence}%)</div>
              <div style={{padding:8,background:"#f5f5fa",borderRadius:6,border:"1px solid #e0e0e8",fontSize:10.5,lineHeight:1.7,maxHeight:80,overflow:"hidden",color:"#555"}}>{SEC.sanitize(ocrResult.text.slice(0,500))}</div>
            </div>}
            {vidEnv&&<div style={{marginBottom:10}}>
              <div style={{fontSize:11,fontWeight:700,color:"#3b5998",marginBottom:4}}>ì˜ìƒ í™˜ê²½ ë¶„ì„</div>
              <table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}>
                <tbody>
                  <tr><th style={{...TS.th,width:"30%"}}>ì‹œê°„ëŒ€</th><td style={TS.td}>{vidEnv.timeOfDay} (í‰ê·  ë°ê¸° {vidEnv.avgBr})</td></tr>
                  <tr><th style={TS.th}>ì‹ í˜¸ ê°ì§€</th><td style={TS.td}>{vidEnv.hasRed?"ğŸ”´ ì ìƒ‰ ":""}{vidEnv.hasGreen?"ğŸŸ¢ ë…¹ìƒ‰ ":""}{vidEnv.hasYellow?"ğŸŸ¡ í™©ìƒ‰ ":""}{!vidEnv.hasRed&&!vidEnv.hasGreen&&!vidEnv.hasYellow?"ë¯¸ê°ì§€":""}</td></tr>
                  <tr><th style={TS.th}>ë¶„ì„ í”„ë ˆì„</th><td style={TS.td}>{vidEnv.perFrame?.length||0}ê°œ</td></tr>
                </tbody>
              </table>
            </div>}
            {!pdfText&&!ocrResult?.text&&!vidEnv&&<div style={{fontSize:11,color:"#999",fontStyle:"italic"}}>ì²¨ë¶€ ì¦ê±°ìë£Œ ì—†ìŒ â€” í…ìŠ¤íŠ¸ ì…ë ¥ ê¸°ë°˜ ë¶„ì„</div>}
          </div></div>

          {/* 3. ê³¼ì‹¤ë¹„ìœ¨ */}
          <div style={TS.sec}><div style={TS.st}>ì œ3ì¥ ê³¼ì‹¤ë¹„ìœ¨ ì‚°ì • ê²°ê³¼</div><div style={TS.sb}>
            <div style={{fontSize:11.5,lineHeight:2,marginBottom:12,color:"#333",whiteSpace:"pre-line"}}>{r.analysis||`ë„í‘œ ${d.id}(${d.t})ì„ ì ìš©í•˜ì—¬ ê³¼ì‹¤ë¹„ìœ¨ì„ ì‚°ì •í•©ë‹ˆë‹¤.`}</div>
            <div style={{display:"flex",height:36,borderRadius:18,overflow:"hidden",border:"2px solid #ddd",margin:"14px 0"}}>
              <div className="fault-bar-a" style={{width:`${r.faultA}%`,minWidth:r.faultA>0?40:0,background:"linear-gradient(135deg,#2c5aa0,#3b82f6)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>{r.faultA>8?`${r.faultA}%`:""}</div>
              <div className="fault-bar-b" style={{width:`${r.faultB}%`,minWidth:r.faultB>0?40:0,background:"linear-gradient(135deg,#c0392b,#e74c3c)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:14}}>{r.faultB>8?`${r.faultB}%`:""}</div>
            </div>
            <div style={{display:"flex",gap:20,justifyContent:"center",margin:"16px 0"}}>
              {[{l:r.labelA,v:r.faultA,c:"#2c5aa0"},{l:r.labelB,v:r.faultB,c:"#c0392b"}].map((p,i)=>
                <div key={i} style={{textAlign:"center",padding:"14px 30px",border:`2px solid ${p.c}30`,borderRadius:10,minWidth:150,background:`${p.c}05`}}>
                  <div style={{fontSize:11,color:"#666",marginBottom:4,fontWeight:600}}>{p.l}</div>
                  <div style={{fontSize:34,fontWeight:900,color:p.c}}>{p.v}%</div>
                </div>)}
            </div>
            <div style={{textAlign:"center",fontSize:13,fontWeight:800,color:"#1a1a2e",margin:"10px 0",padding:8,background:"#f0f4ff",borderRadius:6}}>
              ê³¼ì‹¤ë¹„ìœ¨ = {r.labelA} <span style={{color:"#2c5aa0"}}>{r.faultA}%</span> : {r.labelB} <span style={{color:"#c0392b"}}>{r.faultB}%</span>
            </div>
          </div></div>

          {/* 4. ìˆ˜ì •ìš”ì†Œ */}
          <div style={TS.sec}><div style={TS.st}>ì œ4ì¥ ìˆ˜ì •ìš”ì†Œ ê²€í† </div><div style={TS.sb}>
            <div style={{fontSize:11,lineHeight:2,marginBottom:8,color:"#555"}}>
              ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨({d.bf.p!==undefined?`ë³´í–‰ì ${d.bf.p}%`:`A ${d.bf.a||0} : B ${d.bf.b||0}`})ì— ëŒ€í•˜ì—¬ {MODS_DB.length}ê°œ ìˆ˜ì •ìš”ì†Œë¥¼ ê²€í† í•˜ì˜€ìŠµë‹ˆë‹¤.
            </div>
            {r.appliedMods?.length>0?<table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}>
              <thead><tr><th style={TS.th}>ìˆ˜ì •ìš”ì†Œ</th><th style={{...TS.th,width:"15%"}}>ì¡°ì •</th><th style={{...TS.th,width:"15%"}}>ëŒ€ìƒ</th><th style={{...TS.th,width:"15%"}}>ì ìš©</th></tr></thead>
              <tbody>{r.appliedMods.map((m,i)=><tr key={i} style={{background:m.applied?"#f0fff4":"#fff"}}>
                <td style={TS.td}>{m.n}</td>
                <td style={{...TS.td,textAlign:"center",fontWeight:700,color:m.v>0?"#c0392b":"#2c5aa0"}}>{m.v>0?"+":""}{m.v}%</td>
                <td style={{...TS.td,textAlign:"center"}}>{m.tg==='a'?r.labelA:m.tg==='b'?r.labelB:"ê³µí†µ"}</td>
                <td style={{...TS.td,textAlign:"center",fontWeight:700,color:m.applied?"#16a34a":"#999"}}>{m.applied?"ì ìš©":"ë¯¸ì ìš©"}</td>
              </tr>)}</tbody>
            </table>:<div style={{fontSize:11,color:"#999",fontStyle:"italic"}}>í•´ë‹¹ ë„í‘œì˜ ìˆ˜ì •ìš”ì†Œ ì—†ìŒ</div>}
            {r.mods?.length>0&&<div style={{marginTop:8,fontSize:11,color:"#3b5998"}}>âœ“ ê°ì§€ëœ ìˆ˜ì •ìš”ì†Œ: {r.mods.join(', ')}</div>}
          </div></div>

          {/* 5. ë²•ì  ê·¼ê±° */}
          {r.laws?.length>0&&<div style={TS.sec}><div style={TS.st}>ì œ5ì¥ ê´€ë ¨ ë²•ì  ê·¼ê±°</div><div style={TS.sb}>
            {r.laws.map((l,i)=><div key={i} style={{padding:"7px 12px",borderLeft:"3px solid #3b5998",background:"#f8f9ff",marginBottom:6,borderRadius:"0 4px 4px 0"}}>
              <div style={{fontWeight:700,color:"#2c3e50",fontSize:11.5}}>{l.a}</div>
              <div style={{color:"#666",fontSize:10.5}}>{l.d}</div>
            </div>)}
          </div></div>}

          {/* 6. ìœ ì‚¬ ë„í‘œ */}
          {r.alts?.length>0&&<div style={TS.sec}><div style={TS.st}>ì œ6ì¥ ìœ ì‚¬ ì ìš© ë„í‘œ</div><div style={TS.sb}>
            <table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}>
              <thead><tr><th style={{...TS.th,width:"15%"}}>ë„í‘œë²ˆí˜¸</th><th style={TS.th}>ì‚¬ê³  ìœ í˜•</th><th style={{...TS.th,width:"15%"}}>ë§¤ì¹­ì ìˆ˜</th></tr></thead>
              <tbody>{r.alts.map(a=><tr key={a.id}>
                <td style={{...TS.td,fontWeight:700,color:"#3b5998"}}>{a.id}</td>
                <td style={TS.td}>{a.t}</td>
                <td style={{...TS.td,textAlign:"center"}}>{a.score}ì </td>
              </tr>)}</tbody>
            </table>
          </div></div>}

          {/* 7. ìœ ì‚¬ íŒë¡€ */}
          {r.similar?.length>0&&<div style={TS.sec}><div style={TS.st}>ì œ7ì¥ ìœ ì‚¬ íŒë¡€ ë¶„ì„</div><div style={TS.sb}>
            {r.similar.map(c=><div key={c.id} style={{padding:8,border:"1px solid #e8e8f0",borderRadius:6,marginBottom:6,background:"#fafafa"}}>
              <div style={{fontSize:11,fontWeight:700}}>{c.accidentType} â€” {c.caseNumber||"íŒë¡€ë²ˆí˜¸ ë¯¸ìƒ"}</div>
              <div style={{fontSize:10.5,color:"#666"}}>ê³¼ì‹¤ë¹„ìœ¨: {c.faultA}% : {c.faultB}% {c.court&&`| ${c.court}`}</div>
            </div>)}
          </div></div>}

          {/* 8. ì¢…í•© ì˜ê²¬ */}
          <div style={TS.sec}><div style={{...TS.st,borderLeftColor:"#c0392b"}}>ì œ8ì¥ ì¢…í•© ì˜ê²¬</div><div style={{...TS.sb,fontSize:11.5,lineHeight:2.2,color:"#333"}}>
            <p>ë³¸ ê±´ êµí†µì‚¬ê³ ì— ëŒ€í•˜ì—¬ ì†í•´ë³´í—˜í˜‘íšŒ ã€Œìë™ì°¨ì‚¬ê³  ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€(2023.6)ã€ì„ ì ìš©í•˜ì—¬ ë¶„ì„í•œ ê²°ê³¼,
            ë„í‘œ <b>{d.id}</b>({d.t})ì´ ê°€ì¥ ì í•©í•œ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.</p>
            <p style={{marginTop:8}}>ê¸°ë³¸ ê³¼ì‹¤ë¹„ìœ¨({d.bf.p!==undefined?`ë³´í–‰ì ${d.bf.p}%`:`A ${d.bf.a||0}% : B ${d.bf.b||0}%`})ì—
            {r.mods?.length>0?` ìˆ˜ì •ìš”ì†Œ(${r.mods.join(', ')})ë¥¼ ë°˜ì˜í•˜ì—¬`:' ìˆ˜ì •ìš”ì†Œ ì—†ì´'}
            {' '}ìµœì¢… ê³¼ì‹¤ë¹„ìœ¨ì„ <b>{r.labelA} {r.faultA}% : {r.labelB} {r.faultB}%</b>ë¡œ ì‚°ì •í•©ë‹ˆë‹¤.</p>
            {vidEnv&&<p style={{marginTop:8}}>ì˜ìƒ í™˜ê²½ ë¶„ì„ ê²°ê³¼ ì‚¬ê³  ë‹¹ì‹œ <b>{vidEnv.timeOfDay}</b>(í‰ê· ë°ê¸° {vidEnv.avgBr})ì´ë©°,
            {vidEnv.hasRed||vidEnv.hasGreen?" ì‹ í˜¸ë“±ì´ ê°ì§€ë˜ì–´ ì‹ í˜¸êµì°¨ë¡œ ì‚¬ê³ ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.":" ì‹ í˜¸ë“± ê°ì§€ê°€ ëª…í™•í•˜ì§€ ì•Šì•„ ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."}</p>}
            <p style={{marginTop:12,fontWeight:700,color:"#c0392b"}}>ë³¸ ê°ì •ì„œëŠ” AI ë¶„ì„ì— ê¸°ë°˜í•œ ì°¸ê³ ìë£Œì´ë©°, ë²•ì  êµ¬ì†ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.
            ì •í™•í•œ ê³¼ì‹¤ë¹„ìœ¨ì€ ë³´í—˜ì‚¬ ì‹¬ì˜ ë˜ëŠ” ë²•ì› íŒë‹¨ì„ í†µí•´ ìµœì¢… í™•ì •ë©ë‹ˆë‹¤.</p>
          </div></div>

          {/* FOOTER */}
          <div style={{marginTop:30,padding:14,border:"1px solid #e0e0e0",borderRadius:6,background:"#fefefe",fontSize:10,color:"#888",textAlign:"center",lineHeight:1.8}}>
            ë³¸ ê°ì •ì„œëŠ” ì†í•´ë³´í—˜í˜‘íšŒ ã€Œìë™ì°¨ì‚¬ê³  ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€(2023ë…„ 6ì›”)ã€ì„ ê¸°ë°˜ìœ¼ë¡œ AIê°€ ìë™ ìƒì„±í•œ ì°¸ê³  ë¬¸ì„œì…ë‹ˆë‹¤.<br/>
            ë²•ì  íš¨ë ¥ì´ ì—†ìœ¼ë©°, ì‹¤ì œ ë³´ìƒ ë° ì†Œì†¡ì—ì„œì˜ ê³¼ì‹¤ë¹„ìœ¨ì€ ê´€ë ¨ ë²•ë¥  ë° íŒë¡€ì— ë”°ë¼ ë‹¬ë¦¬ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
            ì •í™•í•œ ê³¼ì‹¤ë¹„ìœ¨ íŒë‹¨ì€ ë³´í—˜ì‚¬, ì†í•´ì‚¬ì •ì¸ ë˜ëŠ” ë²•ë¥ ì „ë¬¸ê°€ì—ê²Œ ë¬¸ì˜í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
          </div>
          <div style={{textAlign:"center",marginTop:20,paddingTop:16,borderTop:"2px solid #1a1a2e"}}>
            <div style={{fontSize:13,fontWeight:800,letterSpacing:1}}>MD Labs</div>
            <div style={{fontSize:10,color:"#666",marginTop:2}}>AI Mobility Data Intelligence</div>
            <div className="stamp" style={{display:"inline-flex",flexDirection:"column",alignItems:"center",justifyContent:"center",border:"2px solid #3b5998",borderRadius:"50%",width:62,height:62,textAlign:"center",fontWeight:900,fontSize:10,color:"#3b5998",marginTop:10,lineHeight:1.3}}>
              <span>MD Labs</span><span style={{fontSize:8}}>AI v7</span>
            </div>
            <div style={{fontSize:9,color:"#aaa",marginTop:10}}>Document ID: {reportId} | Generated: {fmtDate} {fmtTime}</div>
          </div>
        </div>
      </div>
    </div>;
  }

  // â•â•â• RESULT PAGE â•â•â•
  if(page==="result"){
    const r=result;
    return<div style={{minHeight:"100vh",background:C.bg,color:C.t1,fontFamily:"var(--sans)"}}>
      <div style={{padding:"10px 16px",background:"rgba(6,9,16,.9)",backdropFilter:"blur(20px)",borderBottom:`1px solid ${C.b1}`,position:"sticky",top:0,zIndex:50}}>
        <div style={{...mx,display:"flex",alignItems:"center",justifyContent:"space-between",padding:0}}>
          <button onClick={()=>{setPage("input");resetSteps();setShowReport(false)}} style={{background:"none",border:"none",color:C.t2,cursor:"pointer",fontSize:16,padding:"4px 6px"}}>â† ëŒì•„ê°€ê¸°</button>
          <Btn small primary onClick={()=>{setInput("");setResult(null);setFiles([]);setVidSrc(null);setVidEnv(null);setVidFrames([]);setOcrResult(null);setPdfText("");resetSteps();setShowReport(false);setSavedId(null);setFbSent(false);setLlmResult(null);setLlmLoading(false);setPage("input")}}>ğŸ”„ ìƒˆ ë¶„ì„</Btn>
          {result&&!result.error&&<button onClick={()=>setShowReport(true)} style={{padding:"5px 14px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#2c5aa0,#6366f1)",color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer",marginLeft:6}}>ğŸ“„ AI ê°ì •ì„œ</button>}
        </div>
      </div>
      <div style={{...mx,paddingTop:14,paddingBottom:80}}>
        <AgentPipeline stepStates={stepStates}/>
        {r?.error?
          <div style={{background:C.card,border:`1px solid ${C.amber}20`,borderRadius:16,padding:24,textAlign:"center",animation:"fadeUp .3s"}}>
            <div style={{fontSize:36,marginBottom:8}}>ğŸ¤”</div>
            <p style={{fontSize:14,fontWeight:700,color:"#fcd34d",marginBottom:6}}>ë„í‘œ ë§¤ì¹­ ì‹¤íŒ¨</p>
            {vidEnv&&<div style={{background:"rgba(99,102,241,.06)",border:"1px solid rgba(99,102,241,.12)",borderRadius:10,padding:10,marginBottom:12,textAlign:"left"}}>
              <div style={{fontSize:10,fontWeight:700,color:"#818cf8",marginBottom:4}}>ğŸ¬ ì˜ìƒì—ì„œ ê°ì§€ëœ ì •ë³´:</div>
              <div style={{fontSize:11,color:C.t2,lineHeight:1.6}}>
                ì‹œê°„ëŒ€: <b style={{color:vidEnv.timeOfDay==="ì•¼ê°„"?"#fbbf24":"#60a5fa"}}>{vidEnv.timeOfDay}</b> (ë°ê¸° {vidEnv.avgBr})<br/>
                {vidEnv.hasRed&&<>ğŸ”´ ì ìƒ‰ ì‹ í˜¸ ê°ì§€<br/></>}
                {vidEnv.hasGreen&&<>ğŸŸ¢ ë…¹ìƒ‰ ì‹ í˜¸ ê°ì§€<br/></>}
                {vidEnv.hasYellow&&<>ğŸŸ¡ í™©ìƒ‰ ì‹ í˜¸ ê°ì§€<br/></>}
                {!vidEnv.hasRed&&!vidEnv.hasGreen&&!vidEnv.hasYellow&&<>ì‹ í˜¸ë“± ìƒ‰ìƒ ë¯¸ê°ì§€<br/></>}
              </div>
            </div>}
            <p style={{fontSize:11,color:C.t2,lineHeight:1.7,marginBottom:12}}>
              ì˜ìƒë§Œìœ¼ë¡œëŠ” ì‚¬ê³  ìœ í˜•ì„ ì •í™•íˆ íŒë‹¨í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.<br/>
              <b style={{color:"#e2e8f0"}}>ì‚¬ê³  ìƒí™©ì„ í…ìŠ¤íŠ¸ë¡œ í•¨ê»˜ ì…ë ¥</b>í•´ì£¼ì„¸ìš”.
            </p>
            <div style={{textAlign:"left",marginBottom:12}}>
              <div style={{fontSize:10,fontWeight:700,color:C.t3,marginBottom:4}}>ğŸ’¡ ì…ë ¥ ì˜ˆì‹œ:</div>
              {["êµì°¨ë¡œì—ì„œ ë…¹ìƒ‰ ì§ì§„ ì¤‘ ì ìƒ‰ ì‹ í˜¸ìœ„ë°˜ ì°¨ëŸ‰ê³¼ ì¶©ëŒ","ì°¨ì„ ë³€ê²½ ì¤‘ ì¸¡ë©´ ì¶©ëŒ","ë¹„ë³´í˜¸ì¢ŒíšŒì „ ì¤‘ ì§ì§„ ì°¨ëŸ‰ê³¼ ì¶©ëŒ","í›„í–‰ì°¨ê°€ ì¶”ëŒ","ì£¼ì°¨ì¥ì—ì„œ ì¶œì°¨ ì¤‘ í†µë¡œ ì§ì§„ ì°¨ëŸ‰ê³¼ ì ‘ì´‰"].map((ex,i)=>
                <button key={i} onClick={()=>{setInput(ex);setPage("input");resetSteps()}} style={{display:"block",width:"100%",textAlign:"left",padding:"6px 10px",borderRadius:7,border:`1px solid ${C.b1}`,background:"rgba(12,17,30,.5)",color:C.t2,fontSize:10.5,cursor:"pointer",marginBottom:2,lineHeight:1.5}}>
                  <span style={{color:C.indigo,marginRight:4}}>â–¸</span>{ex}
                </button>)}
            </div>
            <Btn primary onClick={()=>{setPage("input");resetSteps()}}>ë‹¤ì‹œ ì…ë ¥</Btn>
          </div>
        :r&&(()=>{const d=r.diagram;return<div style={{animation:"fadeUp .3s"}}>
          <div style={{background:`linear-gradient(135deg,rgba(59,130,246,.06),rgba(139,92,246,.04))`,border:`1px solid rgba(99,102,241,.12)`,borderRadius:18,padding:20,marginBottom:14}}>
            <div style={{display:"flex",gap:5,marginBottom:10,flexWrap:"wrap"}}><Tag color={C.blue}>{d.cat}</Tag><Tag color={C.amber}>{d.id}</Tag><Tag>{d.sub}</Tag><Tag color={r.confidence==="ìƒ"?C.emerald:C.amber}>ì‹ ë¢°ë„:{r.confidence} ({r.matchScore}ì )</Tag></div>
            <h2 style={{fontSize:"clamp(16px,4vw,22px)",fontWeight:800,marginBottom:2}}>{d.t}</h2>
            <FBar la={r.labelA} lb={r.labelB} va={r.faultA} vb={r.faultB}/>
            <div style={{display:"flex",gap:10,justifyContent:"center"}}>
              {[{l:r.labelA,v:r.faultA,c:C.blue},{l:r.labelB,v:r.faultB,c:C.red}].map((p,i)=>
                <div key={i} style={{flex:1,maxWidth:180,padding:14,borderRadius:14,textAlign:"center",background:`${p.c}06`,border:`1px solid ${p.c}12`}}>
                  <div style={{fontSize:10,color:p.c,fontWeight:600,marginBottom:3}}>{p.l}</div>
                  <div style={{fontSize:28,fontWeight:900,color:p.c,fontFamily:"var(--mono)"}}>{p.v}%</div>
                </div>)}
            </div>
          </div>

          {r.alts?.length>0&&<div style={{background:C.card,border:`1px solid ${C.b1}`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ“‹ ìœ ì‚¬ ë„í‘œ</div>
            {r.alts.map(a=><div key={a.id} style={{padding:"5px 8px",borderRadius:7,background:"rgba(6,9,16,.3)",marginBottom:3,fontSize:11,color:C.t2}}>
              <Tag color={C.t3} sx={{fontSize:9,marginRight:4}}>{a.id}</Tag>{a.t} <span style={{fontSize:9,color:C.t3}}>({a.score}ì )</span>
            </div>)}
          </div>}

          {pdfText&&<div style={{background:C.card,border:`1px solid ${C.cyan}10`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:6}}><span>ğŸ“„</span><span style={{fontSize:11,fontWeight:700,color:C.t3}}>PDF ì¶”ì¶œ í…ìŠ¤íŠ¸</span></div>
            <pre style={{padding:8,borderRadius:8,background:"rgba(6,9,16,.5)",fontSize:10,color:C.t2,lineHeight:1.5,whiteSpace:"pre-wrap",fontFamily:"var(--mono)",maxHeight:150,overflowY:"auto"}}>{pdfText.slice(0,3000)}</pre>
            <Btn small onClick={()=>{addToKB(parsePrecedent(pdfText),r?.diagram?.id,r?.diagram?.cat)}} sx={{marginTop:6,fontSize:10}}>ğŸ§  í•™ìŠµDB ì €ì¥</Btn>
          </div>}

          {ocrResult?.text&&<div style={{background:C.card,border:`1px solid ${C.cyan}10`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ” OCR í…ìŠ¤íŠ¸ (ì‹ ë¢°ë„ {ocrResult.confidence}%)</div>
            <pre style={{padding:8,borderRadius:8,background:"rgba(6,9,16,.5)",fontSize:10,color:C.t2,whiteSpace:"pre-wrap",maxHeight:100,overflowY:"auto"}}>{ocrResult.text}</pre>
          </div>}

          {vidEnv&&<div style={{background:C.card,border:`1px solid ${C.violet}10`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ¬ ì˜ìƒ í™˜ê²½</div>
            <div style={{display:"flex",gap:6,flexWrap:"wrap"}}><Tag color={vidEnv.timeOfDay==="ì•¼ê°„"?C.amber:C.blue}>{vidEnv.timeOfDay}</Tag><Tag>ë°ê¸°{vidEnv.avgBr}</Tag>{vidEnv.hasRed&&<Tag color={C.red}>ğŸ”´ ì ìƒ‰</Tag>}{vidEnv.hasGreen&&<Tag color={C.emerald}>ğŸŸ¢ ë…¹ìƒ‰</Tag>}{vidEnv.hasYellow&&<Tag color={C.amber}>ğŸŸ¡ í™©ìƒ‰</Tag>}</div>
          </div>}

          {r.similar?.length>0&&<div style={{background:C.card,border:`1px solid ${C.violet}10`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ§  ìœ ì‚¬ íŒë¡€ {r.similar.length}ê±´</div>
            {r.similar.map(c=><div key={c.id} style={{padding:8,borderRadius:8,background:"rgba(6,9,16,.3)",marginBottom:3,fontSize:11}}>
              <span style={{color:C.blue}}>{c.faultA}%</span>:<span style={{color:C.red}}>{c.faultB}%</span> Â· {c.accidentType} {c.caseNumber&&<span style={{color:C.t3}}>({c.caseNumber})</span>}
            </div>)}
          </div>}

          {r.appliedMods?.length>0&&<div style={{background:C.card,border:`1px solid ${C.b1}`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ”§ ìˆ˜ì •ìš”ì†Œ</div>
            {r.appliedMods.map((m,i)=><div key={i} style={{padding:"4px 8px",borderRadius:7,marginBottom:2,background:m.applied?`${C.blue}06`:"rgba(15,23,42,.3)",fontSize:11}}>
              {m.applied?"âœ…":"â¬œ"} {m.n} <span style={{fontFamily:"var(--mono)",color:m.v>0?"#f87171":"#60a5fa"}}>{m.v>0?"+":""}{m.v}%</span>
            </div>)}
          </div>}

          {r.laws?.length>0&&<div style={{background:C.card,border:`1px solid ${C.b1}`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{fontSize:11,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ“– ê´€ë ¨ ë²•ê·œ</div>
            {r.laws.map((l,i)=><div key={i} style={{padding:"5px 8px",borderRadius:7,background:"rgba(6,9,16,.3)",marginBottom:2,borderLeft:`3px solid ${C.indigo}`}}>
              <div style={{fontSize:11,fontWeight:700,color:"#a5b4fc"}}>{l.a}</div>
              <div style={{fontSize:10,color:C.t2}}>{l.d}</div>
            </div>)}
          </div>}

          <div style={{textAlign:"center",marginBottom:14}}>
            <button onClick={()=>setShowReport(true)} style={{padding:"12px 32px",borderRadius:12,border:"none",background:"linear-gradient(135deg,#1e3a6e,#3b5998,#6366f1)",color:"#fff",fontSize:14,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 20px rgba(59,89,152,.4)",letterSpacing:1}}>
              ğŸ“„ AI ê°ì •ì„œ ì‘ì„±
            </button>
            <p style={{fontSize:10,color:C.t3,marginTop:6}}>ì „ë¬¸ ê°ì •ì„œ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ Â· ì¸ì‡„/PDF ì €ì¥ ê°€ëŠ¥</p>
          </div>

          {(llmLoading||llmResult)&&<div style={{background:C.card,border:`1px solid ${C.violet}15`,borderRadius:14,padding:14,marginBottom:10}}>
            <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}>
              <span>ğŸ¤–</span>
              <span style={{fontSize:11,fontWeight:700,color:C.violet}}>Claude AI ë³´ì¡° ë¶„ì„</span>
              {llmLoading&&<span style={{fontSize:9,color:C.t3,animation:"pulse 1.5s infinite"}}>ë¶„ì„ ì¤‘...</span>}
            </div>
            {llmResult&&<div>
              {llmResult.reasoning&&<p style={{fontSize:11,color:C.t2,lineHeight:1.7,marginBottom:8}}>{llmResult.reasoning}</p>}
              {llmResult.analysis&&<p style={{fontSize:11,color:C.t2,lineHeight:1.7,marginBottom:8}}>{llmResult.analysis}</p>}
              {llmResult.diagram_id&&<div style={{display:"flex",gap:5,flexWrap:"wrap",marginBottom:6}}>
                <Tag color={C.violet}>AIì¶”ì²œ: {llmResult.diagram_id}</Tag>
                {llmResult.fault_a!==undefined&&<Tag color={C.cyan}>AIê³¼ì‹¤: {llmResult.fault_a}:{llmResult.fault_b}</Tag>}
                {llmResult.confidence&&<Tag color={C.amber}>ì‹ ë¢°ë„: {llmResult.confidence}</Tag>}
              </div>}
              {llmResult.detected_modifiers?.length>0&&<div style={{fontSize:10,color:C.t3,marginTop:4}}>ìˆ˜ì •ìš”ì†Œ: {llmResult.detected_modifiers.join(', ')}</div>}
              {llmResult.error&&<p style={{fontSize:10,color:C.amber}}>{llmResult.raw||'AI ë¶„ì„ ê²°ê³¼ íŒŒì‹± ì‹¤íŒ¨'}</p>}
            </div>}
          </div>}

          {savedId&&<div style={{background:C.card,border:`1px solid ${C.emerald}15`,borderRadius:14,padding:14,marginBottom:10,textAlign:"center"}}>
            <div style={{fontSize:11,fontWeight:700,color:C.emerald,marginBottom:8}}>âœ… ë¶„ì„ ê²°ê³¼ê°€ ì„œë²„ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</div>
            {!fbSent?<div>
              <div style={{fontSize:10,color:C.t3,marginBottom:8}}>ì´ ë¶„ì„ ê²°ê³¼ê°€ ì •í™•í•œê°€ìš”? (í•™ìŠµì— ë°˜ì˜ë©ë‹ˆë‹¤)</div>
              <div style={{display:"flex",gap:8,justifyContent:"center"}}>
                <button onClick={()=>{sendFeedback(savedId,true,'ì •í™•í•¨');setFbSent('correct')}} style={{padding:"8px 20px",borderRadius:8,border:"none",background:"rgba(16,185,129,.12)",color:C.emerald,fontSize:12,fontWeight:700,cursor:"pointer"}}>ğŸ‘ ì •í™•í•´ìš”</button>
                <button onClick={()=>{sendFeedback(savedId,false,'ë¶€ì •í™•');setFbSent('wrong')}} style={{padding:"8px 20px",borderRadius:8,border:"none",background:"rgba(239,68,68,.08)",color:C.red,fontSize:12,fontWeight:700,cursor:"pointer"}}>ğŸ‘ í‹€ë ¤ìš”</button>
              </div>
            </div>:
            <div style={{fontSize:11,color:fbSent==='correct'?C.emerald:C.amber,fontWeight:600}}>
              {fbSent==='correct'?'âœ… ê°ì‚¬í•©ë‹ˆë‹¤! ì •í™•ë„ í–¥ìƒì— ë°˜ì˜ë©ë‹ˆë‹¤.':'ğŸ“ í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤. ê°œì„ ì— í™œìš©í•˜ê² ìŠµë‹ˆë‹¤.'}
            </div>}
          </div>}
          {!savedId&&<div style={{textAlign:"center",marginBottom:10}}><span style={{fontSize:9,color:C.t3}}>ğŸ’¾ ì„œë²„ ì €ì¥ ì¤‘...</span></div>}

          <div style={{padding:10,borderRadius:10,background:`${C.amber}04`,border:`1px solid ${C.amber}08`,textAlign:"center"}}>
            <p style={{fontSize:9.5,color:C.t3}}>âš ï¸ ì°¸ê³ ìš© Â· ë²•ì  êµ¬ì†ë ¥ ì—†ìŒ Â· ì •í™•í•œ íŒë‹¨ì€ ë³´í—˜ì‚¬Â·ì „ë¬¸ê°€ ë¬¸ì˜</p>
          </div>
        </div>})()}

        {showReport&&result&&!result.error&&<AIReport r={result} pdfText={pdfText} ocrResult={ocrResult} vidEnv={vidEnv} onClose={()=>setShowReport(false)}/>}
      </div>
    </div>;
  }

  // â•â•â• INPUT PAGE â•â•â•
  return<div style={{minHeight:"100vh",background:C.bg,color:C.t1,fontFamily:"var(--sans)"}}>
    <div style={{padding:"10px 16px",background:"rgba(6,9,16,.9)",backdropFilter:"blur(20px)",borderBottom:`1px solid ${C.b1}`,position:"sticky",top:0,zIndex:50}}>
      <div style={{...mx,display:"flex",alignItems:"center",gap:8,padding:0}}>
        <div style={{width:30,height:30,borderRadius:9,background:`linear-gradient(135deg,${C.blue},${C.violet})`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,flexShrink:0}}>âš–ï¸</div>
        <div style={{flex:1}}><div style={{fontWeight:800,fontSize:13}}>MD Labs <span style={{fontSize:9,color:C.indigo}}>AI</span></div><div style={{fontSize:8.5,color:C.t3}}>ê³¼ì‹¤ë¹„ìœ¨ ë¶„ì„ v7.0</div></div>
        <span style={{fontSize:8,color:C.t3,padding:"2px 6px",borderRadius:4,border:`1px solid ${C.b1}`}}>DB {DB.length}ë„í‘œ Â· {MODS_DB.length}ìˆ˜ì •ìš”ì†Œ Â· {LAWS_DB.length}ë²•ê·œ</span>
        {stats.total>0&&<button onClick={()=>setShowKB(!showKB)} style={{padding:"4px 8px",borderRadius:7,border:`1px solid ${showKB?`${C.violet}30`:C.b1}`,background:showKB?`${C.violet}08`:"transparent",color:showKB?C.violet:C.t3,fontSize:10,fontWeight:600,cursor:"pointer"}}>ğŸ§  {stats.total}</button>}
      </div>
    </div>
    <div style={{...mx,paddingTop:14,paddingBottom:80}}>
      <div style={{textAlign:"center",marginBottom:18}}>
        <h1 style={{fontSize:"clamp(20px,5vw,30px)",fontWeight:900,lineHeight:1.3,marginBottom:4}}>
          êµí†µì‚¬ê³  <span style={{background:`linear-gradient(135deg,${C.blue},${C.violet})`,WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>ê³¼ì‹¤ë¹„ìœ¨</span> ë¶„ì„
        </h1>
        <p style={{fontSize:12,color:C.t2}}>ì‚¬ê³  ìƒí™© ì…ë ¥ â†’ AI ë¶„ì„ â†’ ê³¼ì‹¤ë¹„ìœ¨ ì¦‰ì‹œ í™•ì¸</p>
      </div>

      {running&&<AgentPipeline stepStates={stepStates}/>}

      {showKB&&<div style={{background:C.card,border:`1px solid ${C.violet}10`,borderRadius:14,padding:14,marginBottom:12,animation:"fadeUp .2s"}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:8}}>
          <span style={{fontSize:11,fontWeight:700,color:C.t3}}>ğŸ§  í•™ìŠµ DB ({kb.length}ê±´)</span>
          {kb.length>0&&<Btn small onClick={()=>{if(confirm('ì „ì²´ ì‚­ì œ?')){setKb([]);saveKB([])}}} sx={{color:C.red,fontSize:9}}>ì „ì²´ì‚­ì œ</Btn>}
        </div>
        <textarea id="kb-input" placeholder="íŒë¡€ë¬¸ ë¶™ì—¬ë„£ê¸° â†’ íŒŒì‹± ì €ì¥" style={{width:"100%",padding:8,borderRadius:8,border:`1px solid ${C.b1}`,background:"rgba(6,9,16,.5)",color:C.t1,fontSize:11,resize:"vertical",minHeight:50,outline:"none"}}/>
        <Btn small primary onClick={()=>{const el=document.getElementById('kb-input');if(el?.value?.length>=20){addToKB(parsePrecedent(el.value));el.value=''}}} sx={{marginTop:4}}>íŒŒì‹± & ì €ì¥</Btn>
        {kb.slice(0,6).map(c=><div key={c.id} style={{display:"flex",justifyContent:"space-between",padding:"4px 6px",borderRadius:6,background:"rgba(6,9,16,.3)",marginTop:3,fontSize:10}}>
          <span>{c.accidentType} <span style={{color:C.blue}}>{c.faultA}</span>:<span style={{color:C.red}}>{c.faultB}</span> {c.caseNumber||''}</span>
          <button onClick={()=>removeFromKB(c.id)} style={{background:"none",border:"none",color:C.t3,cursor:"pointer",fontSize:10}}>âœ•</button>
        </div>)}
      </div>}

      <div style={{background:C.card,border:`1px solid ${C.b1}`,borderRadius:18,padding:18,marginBottom:12}}>
        <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:10}}><span style={{fontSize:14}}>ğŸ“</span><span style={{fontSize:12,fontWeight:700}}>ì‚¬ê³  ìƒí™© ì…ë ¥</span></div>
        <textarea ref={taRef} value={input} onChange={e=>setInput(e.target.value)}
          placeholder={"ì‚¬ê³  ìƒí™©ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”.\n\nì˜ˆ: í¸ë„ 2ì°¨ë¡œì—ì„œ 1ì°¨ë¡œ ì§ì§„ ì¤‘ 2ì°¨ë¡œ ì°¨ëŸ‰ì´\nê¹œë¹¡ì´ ì—†ì´ ì°¨ì„ ë³€ê²½í•˜ì—¬ ì¸¡ë©´ ì¶©ëŒ"}
          style={{width:"100%",padding:12,borderRadius:12,border:`1px solid ${C.b2}`,background:"rgba(6,9,16,.5)",color:C.t1,fontSize:13,outline:"none",resize:"vertical",minHeight:90,lineHeight:1.7}}/>
        <div style={{fontSize:9.5,color:C.t3,marginTop:4}}>{input.length}ì{input.length>=5&&<span style={{color:C.emerald}}> âœ“</span>}</div>
      </div>

      <div style={{background:C.card,border:`1px solid ${C.b1}`,borderRadius:18,padding:18,marginBottom:12}}>
        <div style={{display:"flex",alignItems:"center",gap:5,marginBottom:10}}><span style={{fontSize:14}}>ğŸ“</span><span style={{fontSize:12,fontWeight:700}}>íŒŒì¼ ì²¨ë¶€</span><span style={{fontSize:10,color:C.t3}}>(ì„ íƒ)</span></div>
        <label style={{display:"flex",flexDirection:"column",alignItems:"center",padding:18,borderRadius:12,border:`2px dashed ${C.b2}`,background:"rgba(6,9,16,.3)",cursor:"pointer"}}
          onDragOver={e=>{e.preventDefault();e.currentTarget.classList.add('drop-active')}}
          onDragLeave={e=>e.currentTarget.classList.remove('drop-active')}
          onDrop={e=>{e.preventDefault();e.currentTarget.classList.remove('drop-active');addFiles(e.dataTransfer.files)}}>
          <input type="file" multiple accept="image/*,video/*,.txt,.pdf,application/pdf" onChange={e=>{if(e.target.files?.length)addFiles(e.target.files)}} style={{display:"none"}}/>
          <div style={{fontSize:20,marginBottom:3}}>ğŸ“¤</div>
          <div style={{fontSize:11,fontWeight:600}}>í´ë¦­ ë˜ëŠ” ë“œë˜ê·¸</div>
          <div style={{fontSize:9.5,color:C.t3,marginTop:2}}>ğŸ“„ PDF(EDRë³´ê³ ì„œ) Â· ğŸ–¼ï¸ ì´ë¯¸ì§€ Â· ğŸ¬ ì˜ìƒ (ìµœëŒ€ 50MB)</div>
        </label>
        {files.length>0&&<div style={{marginTop:8}}>{files.map(f=><div key={f.id} style={{display:"flex",gap:8,padding:6,borderRadius:8,background:"rgba(6,9,16,.3)",border:`1px solid ${f.pdf?`${C.cyan}15`:C.b1}`,marginBottom:3}}>
          <div style={{width:36,height:36,borderRadius:7,overflow:"hidden",background:"rgba(15,23,42,.4)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,fontSize:14}}>
            {f.preview?<img src={f.preview} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:f.pdf?"ğŸ“„":f.type?.startsWith('video/')?"ğŸ¬":"ğŸ“"}
          </div>
          <div style={{flex:1,minWidth:0}}>
            <div style={{fontSize:10.5,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{f.name}</div>
            <div style={{fontSize:9.5,color:f.pdf?C.cyan:C.t3}}>{(f.size/1024/1024).toFixed(1)}MB Â· {f.pdf?"ğŸ“„ PDF":f.type?.startsWith('image/')?"ğŸ” OCR":f.type?.startsWith('video/')?"ğŸ¬ ì˜ìƒ":"ğŸ“ íŒŒì¼"}</div>
          </div>
          <button onClick={()=>{setFiles(p=>p.filter(x=>x.id!==f.id));if(f.type?.startsWith('video/')){setVidSrc(null);setVidFrames([]);setVidEnv(null)}}} style={{background:"none",border:"none",color:C.t3,cursor:"pointer",fontSize:12,padding:"2px"}}>âœ•</button>
        </div>)}</div>}
        {vidSrc&&<div style={{marginTop:8}}>
          <video ref={vidRef} src={vidSrc} controls playsInline preload="metadata" style={{width:"100%",maxHeight:180,borderRadius:8,background:"#000"}}/>
          <div style={{padding:"6px 8px",borderRadius:7,background:`${C.amber}05`,border:`1px solid ${C.amber}10`,marginTop:4,fontSize:10,color:"#fcd34d"}}>ğŸ’¡ ì˜ìƒì—ì„œ í™˜ê²½ì •ë³´ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤. <b>í…ìŠ¤íŠ¸ë„ í•¨ê»˜ ì…ë ¥</b>í•˜ë©´ ì •í™•ë„ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.</div>
        </div>}
      </div>

      <button onClick={runAnalysis} disabled={running||(!input.trim()&&files.length===0&&!vidSrc)}
        style={{width:"100%",padding:"14px 20px",borderRadius:14,border:"none",
          background:running?"rgba(99,102,241,.12)":(input.trim()||files.length>0||vidSrc)?`linear-gradient(135deg,${C.blue},${C.violet})`:"#1e293b",
          color:running?"#818cf8":(input.trim()||files.length>0||vidSrc)?"#fff":"#475569",
          fontSize:15,fontWeight:800,cursor:running?"wait":"pointer",transition:"all .3s",marginBottom:18,
          animation:running?"pulse 1.5s infinite":"none"}}>
        {running?"ğŸ”„ AI ì—ì´ì „íŠ¸ ë¶„ì„ ì¤‘...":"âš–ï¸ ê³¼ì‹¤ë¹„ìœ¨ ë¶„ì„ ì‹œì‘"}
      </button>

      <div style={{marginBottom:16}}>
        <div style={{fontSize:10,fontWeight:700,color:C.t3,marginBottom:6}}>ğŸ“Œ ì˜ˆì‹œ (í´ë¦­)</div>
        {examples.map((ex,i)=><button key={i} onClick={()=>{setInput(ex);taRef.current?.focus()}}
          style={{display:"block",width:"100%",textAlign:"left",padding:"8px 12px",borderRadius:8,border:`1px solid ${C.b1}`,background:"rgba(12,17,30,.4)",color:C.t2,fontSize:11,cursor:"pointer",lineHeight:1.5,marginBottom:3}}>
          <span style={{color:C.indigo,fontWeight:700,marginRight:5}}>0{i+1}</span>{ex}
        </button>)}
      </div>

      <div style={{textAlign:"center",padding:"10px 0"}}>
        <p style={{fontSize:9,color:C.t3}}>MD Labs AI v7.0 Â· ì†ë³´í˜‘íšŒ ê³¼ì‹¤ë¹„ìœ¨ ì¸ì •ê¸°ì¤€ ê¸°ë°˜ Â· {DB.length}ë„í‘œ Â· {MODS_DB.length}ìˆ˜ì •ìš”ì†Œ Â· {LAWS_DB.length}ë²•ê·œ</p>
      </div>
    </div>
  </div>;
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
